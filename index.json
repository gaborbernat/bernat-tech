{"version":"https://jsonfeed.org/version/1.1","title":"Bernát Gábor - Engineering \u0026 Open Source","home_page_url":"https://bernat.tech/","feed_url":"https://bernat.tech/index.json","description":"Bernát Gábor's personal website","authors":[{"name":"Bernát Gábor"}],"language":"en","items":[{"id":"https://bernat.tech/posts/version-numbers/","url":"https://bernat.tech/posts/version-numbers/","title":"Version numbers: how to use them?","content_html":"\u003cp\u003eThe \u003ca href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eDRY principle\u003c/a\u003e (an acronym for don\u0026rsquo;t repeat yourself)\nencourages software engineers to abstract code into a separate component and reuse it rather than write it over and over\nagain. If this happens across the system, the best practice is to put it inside a package that lives on its own (a\nlibrary) and then pull it in from the applications when required.\u003c/p\u003e\n\u003cp\u003eAs most of us can\u0026rsquo;t think of every feature that the library might offer or what bugs it might contain, these packages\ntend to evolve. Therefore, we need some mechanism to encode these evolutions of the library, and most commonly, this is\na version number.\u003c/p\u003e\n\u003cp\u003eVersion numbers and their meaning will come up both as a producer or as a consumer of libraries:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eas a producer of libraries, you\u0026rsquo;ll have to decide what versioning system to use,\u003c/li\u003e\n\u003cli\u003eas a consumer, you\u0026rsquo;ll have to express what versions of a given library your application/library is compatible.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhat is a great version number, you might ask? If you do a quick search around, you\u0026rsquo;ll find there are\n\u003ca href=\"https://en.wikipedia.org/wiki/Software_versioning\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003emultiple schools of thought here\u003c/a\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://semver.org/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003esemantic versioning\u003c/a\u003e (of which \u003ca href=\"https://0ver.org/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eZeroVer\u003c/a\u003e is an ever-popular subset)\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://calver.org/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ecalendar versioning\u003c/a\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor those who read my articles, you\u0026rsquo;ll know I like to sprinkle my otherwise technically dry posts with some lovely and\ncute animal photos to give you at least some moments of relief while you\u0026rsquo;re going through it. In this one, I\u0026rsquo;ll use\npictures from my Yorkshire Terrier puppy, Silky. Without further ado (#ToT!!!)\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_tot_hu_8cd119c7b9567fc4.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_tot_hu_6e45e4b1848882c8.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_tot.webp\" alt=\"Silky the Yorkshire Terrier puppy\"\n        width=\"700\" height=\"417\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"semantic-and-zerover\"\u003e\n  Semantic and ZeroVer\n  \u003ca class=\"heading-link\" href=\"#semantic-and-zerover\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eSo, which should you use? Historically, the go-to answer has been semantic versioning. This is defined as a three-number\nstring (separated with a period) in the format of \u003ccode\u003eMAJOR.MINOR.PATCH\u003c/code\u003e. Usually, it starts with \u003ccode\u003e0.1.0\u003c/code\u003e. Then depending\non the type of change you make to the library, you increment one of these and set subsequent numbers to zero:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eMAJOR\u003c/code\u003e version if you make backward-incompatible changes,\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eMINOR\u003c/code\u003e version if you add a new feature,\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePATCH\u003c/code\u003e version if you fix bugs.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eVersion two of semantic versioning introduced additional labels to indicate pre-releases and build metadata; these are\nappended after a hyphen at the end, for example, \u003ccode\u003e1.0.0-beta+exp.sha.5114f8\u003c/code\u003e. For the point of this blog post, these are\nnot important. ZeroVer (a joke versioning system - released on April 1st) is similar to this with the sole difference\nthat \u003ccode\u003eMAJOR\u003c/code\u003e is always \u003ccode\u003e0\u003c/code\u003e and incompatible changes may be introduced at any point. It intended to make fun of people\nwho use \u0026ldquo;semantic versioning\u0026rdquo; but never make a \u003ccode\u003e1.0\u003c/code\u003e release, thus defeating the purpose of semver.\u003c/p\u003e\n\u003cp\u003eThe version number in this context is used as a contract between the library developer and the systems pulling it in\nabout how freely they can upgrade. For example, if you wrote your web server against\n\u003ca href=\"https://pypi.org/project/Django/#history\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eDjango 3\u003c/a\u003e, you should be good to go with all Django 3 releases that are at\nleast as new as your current one. This allows you to express your Django dependency in the format of\n\u003ccode\u003eDjango \u0026gt;= 3.0.2, \u0026lt;4\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eBy using this format whenever you rebuild your application, you\u0026rsquo;ll automatically pull in any new feature/bugfix/security\nreleases of \u003ccode\u003eDjango\u003c/code\u003e, enabling you to use the latest and best version that is still guaranteed to work with your\nproject. This is great because:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eyou enable automatic, compatible security fixes,\u003c/li\u003e\n\u003cli\u003eit automatically pulls in bug fixes on the library side,\u003c/li\u003e\n\u003cli\u003eyour application will keep building and working in the future as it did today because the significant version pin\nprotects you from pulling in versions whose API would not match.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eDoes this uphold in practice? For me, \u003ca href=\"https://hynek.me/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eHynek Schlawack\u003c/a\u003e pointed out first that it does not.\nInitially, in some \u003ca href=\"https://twitter.com/llanga/status/1253962015846121472\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etweets\u003c/a\u003e, and then in more detail within a\ntalk held at a \u003ca href=\"https://remote.python.pizza/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eRemote Python Pizza\u003c/a\u003e conference. Looking back at my experience with this,\nI tend to agree.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_sit_hu_1a2ab607e2cf2454.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_sit_hu_cb6cdaf5b409b8ed.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_sit.webp\" alt=\"Silky sitting\"\n        width=\"700\" height=\"696\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"whats-the-problem-with-semantic-versioning\"\u003e\n  What\u0026rsquo;s the problem with semantic versioning?\n  \u003ca class=\"heading-link\" href=\"#whats-the-problem-with-semantic-versioning\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eOn paper, semantic versioning seems to be addressing all we need to encode the evolution and state of our library. I\nthink the issue is not with the semantic versioning standard itself; indeed, people would like to follow it. However,\n\u003cstrong\u003emost library maintainers/developers out there don\u0026rsquo;t have enough resources to follow semantic versioning\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eMaintaining a library is very time-consuming. I can attest to that, as I have maintained two myself for a few years now:\ntox (3) and virtualenv (2). My experience is within the Python ecosystem, but I can imagine other languages are similar.\nMost libraries have just a few active maintainers available, for example:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003etox has 2,\u003c/li\u003e\n\u003cli\u003evirtualenv 1,\u003c/li\u003e\n\u003cli\u003epytest around 4,\u003c/li\u003e\n\u003cli\u003epip around 4,\u003c/li\u003e\n\u003cli\u003epython-dateutil 1.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd these are very high-profile libraries. To make things even worse, some of their maintainers overlap (i.e., the same\nperson is the maintainer of multiple projects). And to complicate matters even further, for most maintainers this is not\na full-time job, but something on the side, part of their free time.\u003c/p\u003e\n\u003cp\u003eGiven the scarce human resources to maintain a library, in practice, there\u0026rsquo;s a single supported version for any library\nat any given point in time: \u003cstrong\u003ethe latest one\u003c/strong\u003e. Any version before that (be that major, minor, patch) is in essence\nabandoned:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eif you want security updates, you need to move to the latest version,\u003c/li\u003e\n\u003cli\u003eif you wish to a bugfix you need to move to the newest version,\u003c/li\u003e\n\u003cli\u003eif you want a new feature, it is only going to be available in the latest version.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eYou get the idea. Unless you\u0026rsquo;re thrilled with your current version, to pull in any change you will need to move to the\nlast released version (be that security improvement, bugfix, or feature). Otherwise, you\u0026rsquo;ll not get it.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_wind_hu_2490db7ccc46bd92.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_wind_hu_43cf71b72b7fc0f.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_wind.webp\" alt=\"Silky in the wind\"\n        width=\"700\" height=\"557\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"will-a-major-version-bump-always-break-you\"\u003e\n  Will a major version bump always break you?\n  \u003ca class=\"heading-link\" href=\"#will-a-major-version-bump-always-break-you\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eAt this point, you might think, \u0026ldquo;OK, so I need to pin down to the major version\u0026rdquo;. As in, you need to specify the\ndependency in the form of \u003ccode\u003etox\u0026gt;=3, \u0026lt;4\u003c/code\u003e. However, semantic versioning is very strict about changing the API. Any\nbackward-incompatible change (no matter how small it is) must be followed with a major number bump.\u003c/p\u003e\n\u003cp\u003eA major version bump \u003cstrong\u003emust\u003c/strong\u003e happen not only when you rewrite an entire library with its complete API, but also when\nyou\u0026rsquo;re just renaming a single rarely used function (which some may erroneously view as a minor change). Or even worse,\nit\u0026rsquo;s not always clear what\u0026rsquo;s part of the public API and what\u0026rsquo;s not.\u003c/p\u003e\n\u003cp\u003eYou have a library with some incidental, undocumented, and unspecified behavior that you consider to be obviously not\npart of the public interface. You change it to solve what seems like a bug to you, and make a patch release, only to\nfind that you have angry hordes at the gate who, thanks to \u003ca href=\"https://www.hyrumslaw.com/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eHyrum\u0026rsquo;s Law\u003c/a\u003e, depend on the old\nbehavior.\u003c/p\u003e\n\u003cfigure\u003e\u003cimg src=\"https://imgs.xkcd.com/comics/workflow.png\" alt=\"XKCD workflow comic\"\n      loading=\"lazy\" decoding=\"async\"\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eWhile every maintainer would like to believe they\u0026rsquo;ve thought of every use case up-front and created the best API for\neverything, in practice, hindsight is our best teacher. As we run into more use cases, issues, and users, we get smarter\nand work out what would be a better interface for that library, and what confuses the users the most.\u003c/p\u003e\n\u003cp\u003eTherefore there will be a lot of moments when, as a maintainer, you would like to change something. Doing a major bump\nchange every time will make your project quickly reach double-digit major versions, at which point users tend to\nconsider your project too unstable to be trusted. Often these major number changes only affect a low percentage of your\nusers (usually those using that one feature you changed in an incompatible fashion).\u003c/p\u003e\n\u003cp\u003eWith a major version pinning the majority of other users are effectively opting out of bug fixes and security updates\n(which should be critical), to defend against a change that in practice will rarely impact them. Sure, they can move on\nto the next version by pinning again via something like \u003ccode\u003etox\u0026gt;=4, \u0026lt;5\u003c/code\u003e. However, this involves manual intervention on\ntheir code, and you might not have the time to do this for every one of your projects.\u003c/p\u003e\n\u003cp\u003eIn my experience, this happens a lot. A lot more at least than when a major version bump breaks you. And then there\u0026rsquo;s\nanother aspect version pinning will introduce: version conflicts.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_tot_2_hu_7ab2628cc225f391.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_tot_2_hu_1bba1ed33e0c5f29.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_tot_2.webp\" alt=\"Silky the puppy running\"\n        width=\"700\" height=\"648\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"version-conflicts\"\u003e\n  Version conflicts\n  \u003ca class=\"heading-link\" href=\"#version-conflicts\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eAn application or library will have a set of libraries it depends on directly. These are libraries you\u0026rsquo;re directly\nimporting within the application/library you\u0026rsquo;re maintaining, but then the libraries themselves may rely on other\nlibraries. This is known as a transitive dependency. Very soon, you\u0026rsquo;ll get to a point where two different components use\nthe same library, and both of them might express version constraints on it.\u003c/p\u003e\n\u003cp\u003eFor example, consider the case of \u003ca href=\"https://pypi.org/project/tenacity/#history\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etenacity\u003c/a\u003e: a general-purpose retrying\nlibrary. Imagine you were using this in your application, and being a religious follower of semantic versioning, you\u0026rsquo;ve\npinned it to the version that was out when you created the app in early 2018: 4.11. The constraint would specify version\n4.11 or later, but less than the next major version 5.\u003c/p\u003e\n\u003cp\u003eAt the same time, you also connect to an HTTP service. This connection is handled by another library, and the maintainer\nof that decided to also use tenacity to offer automatic retry functionality. They pinned it similarly following the\nsemantic versioning convention. Back in 2018, this caused no issues. But then August comes, and version 5.0 is released.\u003c/p\u003e\n\u003cp\u003eThe service and its library maintainers have a lot more time on their hands (perhaps because they are paid to do so), so\nthey quickly move to version 5.0. Or perhaps they want to use a feature from the new major version. Now they introduce\nthe pin greater than five but less than six on tenacity. Their public interface does not change at all at this point, so\nthey do not bump their major version. It\u0026rsquo;s just a patch release.\u003c/p\u003e\n\u003cp\u003ePython can only have one version of a library installed at a given time. At this point, there is a version conflict.\nYou\u0026rsquo;re requesting a version between four and five, while the service library is requesting a version between five and\nsix. Both constraints cannot be satisfied.\u003c/p\u003e\n\u003cp\u003eIf you use a version of \u003ca href=\"https://pypi.org/project/pip\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epip\u003c/a\u003e older than 20.2 ­— the release in which it added a\ndependency resolver — it will just install a version matching the first constraint it finds and ignore any subsequent\nconstraints. Versions of pip \u003cem\u003eafter\u003c/em\u003e 20.2 would fail with an error indicating that the constraint cannot be satisfied.\u003c/p\u003e\n\u003cp\u003eEither way, your application no longer works. The only way to make it work is to either pin the service library down to\nthe last working patch number, or upgrade your version pinning of tenacity. This is generating extra work for you with\nminimal benefit. Often it might not be even possible to use two conflicting libraries until one of them relaxes their\nrequirements.\u003c/p\u003e\n\u003cp\u003eAnd for those who might think this doesn\u0026rsquo;t happen often, let me say that tenacity released another major version a year\nlater in November 2019. Thus, the cycle starts all over again. In both cases, your code most likely did not need to\nchange at all, as just a small part of their public API changed.\u003c/p\u003e\n\u003cp\u003eA mildly complex application will easily have close to (or possibly more than) 100 dependencies, so such issues in my\nexperience start to appear every few months. You need only 5-6 of such cases for every 100 libraries for this issue to\npop up every two months on your plate. And potentially for a multiple of your applications.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_yes_hu_aa09bb5a01c01ef8.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_yes_hu_36054eb81236b06.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_yes.webp\" alt=\"Silky looking up\"\n        width=\"700\" height=\"665\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"calendar-versioning\"\u003e\n  Calendar Versioning\n  \u003ca class=\"heading-link\" href=\"#calendar-versioning\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://en.wikipedia.org/wiki/Software_versioning#Date_of_release\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eCalVer\u003c/a\u003e, which was\n\u003ca href=\"https://sedimental.org/designing_a_version.html#calendar_versioning\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ecodified by Mahmoud Hashemi\u003c/a\u003e, suggests version\nnumber to be in format of: \u003ccode\u003eYEAR.MONTH.sequence\u003c/code\u003e. For example, \u003ccode\u003e20.1\u003c/code\u003e indicates a release in 2020 January, while\n\u003ccode\u003e20.5.2\u003c/code\u003e indicates a release that occurred in 2020 May, while the 2 indicates this is the third release of the month.\u003c/p\u003e\n\u003cp\u003eYou can see it looks similar to semantic versioning and has the benefit that a later release qualifies as bigger than an\nearlier one within the semantic versioning world (which mandates that a version number must grow monotonically). This\nmakes it easy to use in all places where semantic versioning can be used.\u003c/p\u003e\n\u003cp\u003eThe idea here is that if the only maintained version is the latest, then we might as well use the version number to\nindicate the release date to signify just how old of a version you\u0026rsquo;re using. You also have the added benefit that you\ncan make calendar-based promises. For example, Ubuntu offers five years of support, therefore given version \u003ccode\u003e20.04\u003c/code\u003e you\ncan quickly determine that it will be supported up to April 2025.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_jump_hu_16690993dffbdff9.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_jump_hu_fb582372e2c4a68f.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_jump.webp\" alt=\"Silky jumping\"\n        width=\"700\" height=\"734\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"a-better-way-to-handle-api-evolution\"\u003e\n  A better way to handle API evolution?\n  \u003ca class=\"heading-link\" href=\"#a-better-way-to-handle-api-evolution\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eSemantic versioning uses the major version to defend against breaking changes, and at the same offers maintainers the\nfreedom to evolve the library without breaking users. Nevertheless, as we could see above in practice, this does not\nseem to work that well, as it causes you not to pull in bug fixes/security updates while also introducing version\nconflicts. Do we have a better tool at hand for this?\u003c/p\u003e\n\u003cp\u003eHynek suggests instead clear, time-window based deprecation policies, and as an optional sprinkle on top, warning\nmessages when using deprecated content. When you want to change a public-facing API: release the change under a new\ninterface, and in parallel, start emitting warning messages whenever someone invokes the old one. Maintain this state\nfor a migration period of a year, and communicate explicitly in the warning message the timeline for when users have to\nmigrate (calculate this by adding one year to your release date).\u003c/p\u003e\n\u003cp\u003eThis gives everyone a year to move to the new interface without breaking their system, and then the library may remove\nthe change and get rid of the old design chains forever. As an added benefit, only people using the old interface will\never see the warning, as opposed to affecting everyone (as seen with the semantic versioning major version bump).\u003c/p\u003e\n\u003cp\u003eOne caveat for this to work is that one should stop upper-pinning dependencies. You should only specify the minimum\nversion you need to pull in newer versions freely if they exist. Lessons learned from version conflicts, though, might\nalready prompt you to do so. A major version breaks you a lot less often in practice than semantic versioning leads you\nto believe.\u003c/p\u003e\n\u003cp\u003eDonald Stufft has also taken on this subject in a blog post titled\n\u003ca href=\"https://caremad.io/posts/2016/02/versioning-software/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eVersioning Software\u003c/a\u003e. I encourage you to read that too. Besides\nthe above points, he argues that by using semantic versioning, you\u0026rsquo;re able to communicate to the end-user the intended\nimpact of a new release.\u003c/p\u003e\n\u003cp\u003eA patch version bump indicates no significant change is expected, and users should be able to upgrade quickly. A minor\nor major version bump shows that the upgrade might introduce significant changes, and that users should set aside a\nconsiderable amount of time when bumping such dependencies.\u003c/p\u003e\n\u003cp\u003eI operate slightly differently in the sense that I don\u0026rsquo;t diff releases. Instead, I tend to \u003cstrong\u003eupgrade without version\nconstraints\u003c/strong\u003e. If the CI fails, I don\u0026rsquo;t merge it; rather I investigate the failure when I have free time on my hands.\nLessons from the trenches suggest that \u003cstrong\u003ethe only way to ensure an upgrade of any magnitude does not break you is to\nhave a comprehensive test suite.\u003c/strong\u003e Ideally, your test framework can collect and report whenever and where your code is\ncalling deprecated functions (\u003ca href=\"https://docs.pytest.org/en/latest/warnings.html#warnings-capture\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003efor example pytest\u003c/a\u003e).\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_wise_hu_5bde3f26931a68db.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_wise_hu_c068afdb0fef36bf.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_wise.webp\" alt=\"Silky looking wise\"\n        width=\"700\" height=\"696\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"summary\"\u003e\n  Summary\n  \u003ca class=\"heading-link\" href=\"#summary\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eIs semantic versioning irrevocably broken? Should it never be used? I don\u0026rsquo;t think so. It still makes a lot of sense\nwhere there are ample resources to maintain multiple versions in parallel. A great example of this is Django. However,\nit feels less practical for projects that have just a few maintainers.\u003c/p\u003e\n\u003cp\u003eIn this case, it often leads to opting people out of bug fixes and security updates. It also encourages version\nconflicts in environments that can\u0026rsquo;t have multiple versions of the same library, as is the case with Python.\nFurthermore, it makes it a lot harder for developers to learn from their mistakes and evolve the API to a better place.\nRotten old design decisions will pull down the library for years to come.\u003c/p\u003e\n\u003cp\u003eA better solution at hand can be using CalVer and a time-window based warning system to evolve the API and remove old\ninterfaces. Does it solve all problems? Absolutely not.\u003c/p\u003e\n\u003cp\u003eOne thing it makes harder is library rewrites. For example, consider\n\u003ca href=\"https://pypi.org/project/virtualenv/20.0.20/#history\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003evirtualenv\u0026rsquo;\u003c/a\u003es recent rewrite. Version 20 introduced a completely\nnew API and changed some behaviours to new defaults. For such use cases in a CalVer world, you would likely need to\nrelease the rewritten project under a new name, such as virtualenv2. Then again, such complete rewrites are extremely\nrare (in the case of virtualenv, it involved twelve years passing).\u003c/p\u003e\n\u003cp\u003eNo version scheme will allow you to predict with any certainty how compatible your software will be with potential\nfuture versions of your dependencies. The only reasonable choices are for libraries to choose minimum versions/excluded\nversions only, never maximum versions. For applications, do the same thing, but also add in a lock file of known, good\nversions with exact pins (this is the fundamental difference between\n\u003ca href=\"https://packaging.python.org/en/latest/discussions/install-requires-vs-requirements/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003einstall_requires and requirements.txt\u003c/a\u003e).\u003c/p\u003e\n\u003cp\u003eIf you got this far you might want to also check the reasoning of\n\u003ca href=\"https://snarky.ca/why-i-dont-like-semver/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eBrett Cannon - Why I don\u0026rsquo;t like SemVer anymore\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eI want to thank \u003ca href=\"https://twitter.com/codewithanthony\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eAnthony Sottile\u003c/a\u003e, \u003ca href=\"https://twitter.com/pganssle\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePaul Ganssle\u003c/a\u003e,\n\u003ca href=\"https://twitter.com/hynek\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eHynek Schlawack\u003c/a\u003e, and \u003ca href=\"https://twitter.com/LisaMcString\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eLisa McCord\u003c/a\u003e for reviewing this\narticle in its draft versions and suggesting changes that made it a thousand times better.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/version-numbers/silky_run_happy_hu_3aa43a1d7f7d7f4c.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/version-numbers/silky_run_happy_hu_f7d7be02b1684d4c.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/version-numbers/silky_run_happy.webp\" alt=\"Silky running happily\"\n        width=\"700\" height=\"525\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n","date_published":"2020-05-16T14:15:00Z","date_modified":"2026-02-15T09:30:25-08:00","tags":["python","version","semver","calver","0ver"]},{"id":"https://bernat.tech/posts/growing-pain/","url":"https://bernat.tech/posts/growing-pain/","title":"Python packaging - Growing Pains","content_html":"\u003cp\u003eIn my previous two posts, I\u0026rsquo;ve gone over [what package types python has](https://bernat.tech/posts/pep-517-and-python-packaging/),\nand [how the package building works](https://bernat.tech/posts/pep-517-518/), especially with the introduction of the PEP-517/518.\nAlthough the changes were primarily to make things more robust, we did run into a few issues while implementing it and\nreleasing it. This post will go over a few, hopefully serving as lessons learned for all of us and presenting some\ninteresting problems to solve in the future.\u003c/p\u003e\n\u003cp\u003eLooking at the changes of PEP-517 and PEP-518, one can identify those build backends (aka setuptools, flit) had very\nlittle to do, only also to expose their functionality via a Python module. Most heavy work is on the build frontend,\nwhich now needs to generate the isolated Python and then invoke the build backends in a new way. When we\u0026rsquo;re talking\nabout build frontends nowadays, our options are mostly pip or poetry (and tox for developers).\u003c/p\u003e\n\u003cp\u003eThese projects are maintained by the community, by a handful of active developers, in their free time. They are not\ngetting paid for it, and they need to be careful to consider the myriad ways these tools are used. Considering this,\nit\u0026rsquo;s not much of a surprise it took almost two years after the PEP acceptance to come out with a first implementation.\nPlanning, testing, and implementation have been going on for over a year in the background.\u003c/p\u003e\n\u003cp\u003eAgainst all the preparations, though, inevitably, the first release did break a few packages, mostly where people\nperformed some operations that caught the maintainers by surprise. Let\u0026rsquo;s try to understand a few of these examples and\nhow did they get addressed.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/growing-pain/stand_pug_hu_52ac955d3e1498d3.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/growing-pain/stand_pug_hu_6c52b91bbec06c42.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/growing-pain/stand_pug.webp\" alt=\"Standing pug\"\n        width=\"700\" height=\"467\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"pep-518\"\u003e\n  PEP-518\n  \u003ca class=\"heading-link\" href=\"#pep-518\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eThe PEP introduces the \u003ca href=\"https://github.com/toml-lang/toml\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eTOML file format.\u003c/a\u003e A format specially created to be easy to\nread/write configurations. While packaging configuration is exposed under the \u003ccode\u003ebuild-system\u003c/code\u003e section, other tools are\nfree to put their configuration under the \u003ccode\u003etool:name\u003c/code\u003e section if they own the PyPi namespace for the name. Various tools\nstarted to take advantage of this right away (such as \u003ca href=\"https://pypi.org/project/towncrier/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etowncrier\u003c/a\u003e,\n\u003ca href=\"https://pypi.org/project/black/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eblack\u003c/a\u003e, etc.).\u003c/p\u003e\n\u003cp\u003eWhen \u003ca href=\"https://pip.pypa.io/en/stable/news/#id61\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epip 18.0 (released 2018 July 22\u003c/a\u003e) added support for PEP-518 packages\nusing the \u003ccode\u003epyproject.toml\u003c/code\u003e initially broke, as the PEP-518 mandated that all packages having the \u003ccode\u003epyproject.toml\u003c/code\u003e\n\u003cstrong\u003emust\u003c/strong\u003e specify the \u003ccode\u003ebuild-backend\u003c/code\u003e section. But packages beforehand used it only as a configuration file for these\nother projects since they didn\u0026rsquo;t specify it pre-emptively; when pip ran into these files, it just raised errors\ncomplaining of invalid \u003ccode\u003epyproject.toml\u003c/code\u003e files.\u003c/p\u003e\n\u003ch2 id=\"pep-517\"\u003e\n  PEP-517\n  \u003ca class=\"heading-link\" href=\"#pep-517\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003ch3 id=\"the-pip-wheel-cache-issue\"\u003e\n  The pip wheel cache issue.\n  \u003ca class=\"heading-link\" href=\"#the-pip-wheel-cache-issue\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eThe way pip installs in a PEP-517 world is first to generate a wheel and then extract that. To be in PEP-517 world one\n\u003cstrong\u003emust\u003c/strong\u003e specify the \u003ccode\u003ebuild-backend\u003c/code\u003e key. Otherwise, all frontends per specification need to fallback to using the\n\u003ccode\u003esetup.py\u003c/code\u003e commands.\u003c/p\u003e\n\u003cp\u003eWhen pip builds wheels, it does it by default via a caching system. This is a speed-up mechanism so that if multiple\nvirtual environments need the same wheel, we don\u0026rsquo;t keep rebuilding it but instead re-use it. The PEP-517 wheel build\noperation also takes advantage of this.\u003c/p\u003e\n\u003cp\u003eThis becomes troublesome, though, when you disable the cache. Now there\u0026rsquo;s no target folder where to build the wheel. So\nthe build itself fails \u003ca href=\"https://github.com/pypa/pip/issues/6158\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003esee the attached issue.\u003c/a\u003e The problem manifested early,\nthough, but en masse, as most CI systems run with this option turned on. Just a day later pip 19.0.1 fixed this.\u003c/p\u003e\n\u003ch3 id=\"pyprojecttoml-not-being-included-into-setuptools\"\u003e\n  \u003ccode\u003epyproject.toml\u003c/code\u003e not being included into setuptools\n  \u003ca class=\"heading-link\" href=\"#pyprojecttoml-not-being-included-into-setuptools\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eIt turns out there\u0026rsquo;s more work on the build backend than just expose their API as described in PEP-517. The backend also\nneeds to ensure that \u003ccode\u003epyproject.toml\u003c/code\u003e is attached to the built source package. Otherwise, the build backend on the user\nmachine will not be able to use it. \u003ca href=\"https://github.com/pypa/setuptools/pull/1650\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003esetuptools 1650\u003c/a\u003e will fix this for\nsetuptools. One can include \u003ccode\u003epyproject.toml\u003c/code\u003e by specifying it inside \u003ccode\u003eMANIFEST.in\u003c/code\u003e on earlier versions.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/growing-pain/chair_pug_hu_1bead99d45d517cd.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/growing-pain/chair_pug_hu_65bddb8c16d434c9.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/growing-pain/chair_pug.webp\" alt=\"Pug on chair\"\n        width=\"700\" height=\"469\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"importing-the-built-package-from-within-setuppy\"\u003e\n  Importing the built package from within \u003ccode\u003esetup.py\u003c/code\u003e\n  \u003ca class=\"heading-link\" href=\"#importing-the-built-package-from-within-setuppy\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eAnother unexpected issue was when a package was importing from within \u003ccode\u003esetup.py\u003c/code\u003e. The version of the package by\nconvention is exposed both as metadata for the package (in case of setuptools inside the \u003ccode\u003esetup.py\u003c/code\u003e as the \u003ccode\u003eversion\u003c/code\u003e\nargument to the \u003ccode\u003esetup\u003c/code\u003e function), but also under the \u003ccode\u003e__version__\u003c/code\u003e variable at the root of the package. One could\nspecify the content of the variable in both places, but then it becomes troublesome to keep it in sync.\u003c/p\u003e\n\u003cp\u003eAs a workaround, many packages started putting it inside a \u003ccode\u003eversion.py\u003c/code\u003e at the root of the package, and then import it\nas \u003ccode\u003efrom mypy.version import __version__ as version\u003c/code\u003e from both the \u003ccode\u003esetup.py\u003c/code\u003e and the package root. This worked because\nwhen someone calls a python script, the current working directory is automatically attached to the \u003ccode\u003esys.path\u003c/code\u003e (so you\ncan import stuff exposed underneath it).\u003c/p\u003e\n\u003cp\u003eThis behavior of adding the current working directory though was never mandated. It was more of a side-effect as calling\nthe build via \u003ccode\u003epython setup.py sdist\u003c/code\u003e. As this behavior is a side-effect (not a guarantee) all projects that import from\ntheir \u003ccode\u003esetup.py\u003c/code\u003e should explicitly add the scripts folder to the \u003ccode\u003esys.path\u003c/code\u003e, at the start of the build.\u003c/p\u003e\n\u003cp\u003eIt\u0026rsquo;s up for debate if importing the built package during the packaging (when it\u0026rsquo;s not yet built/distributed) is a good\nidea or not (though the Python Packaging group is leaning towards it\u0026rsquo;s not). Nevertheless, the fact of the matter is\nthat when \u003ccode\u003esetuptools\u003c/code\u003e exposed its interface via the \u003ccode\u003esetuptools.build_meta\u003c/code\u003e, it chooses not to add the current working\ndirectory to the system path.\u003c/p\u003e\n\u003cp\u003eThe PEP never mandates for the frontend to do this addition, as most build backend (declarative by nature) will never\nneed this. Such functionality was deemed to be under the responsibility of the front end. \u003ccode\u003esetuptools\u003c/code\u003e respectively\nthink if users want this functionality, they should be explicit in their \u003ccode\u003esetup.py\u003c/code\u003e and prepend the respective path to\nthe \u003ccode\u003esys.path\u003c/code\u003e manually.\u003c/p\u003e\n\u003cp\u003eTo simplify the pip code base pip decided to opt in into PEP-517 all people having a \u003ccode\u003epyproject.toml\u003c/code\u003e into the\n\u003ccode\u003esetuptools\u003c/code\u003e backend. Now with this issue even packages that haven\u0026rsquo;t opted in to PEP-517 started to break. To fix this,\n\u003ccode\u003esetuptools\u003c/code\u003e added a new build backend (\u003ccode\u003esetuptools.build_meta:__legacy__\u003c/code\u003e) designed to be used by frontends as a\ndefault when the build backend is left unspecified; when projects add the \u003ccode\u003ebuild-backend\u003c/code\u003e key, they will have to also\nchange their \u003ccode\u003esetup.py\u003c/code\u003e to either add the source root to their \u003ccode\u003esys.path\u003c/code\u003e or avoid importing from the source root.\u003c/p\u003e\n\u003ch3 id=\"self-bootstrapping-backends\"\u003e\n  self bootstrapping backends\n  \u003ca class=\"heading-link\" href=\"#self-bootstrapping-backends\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eAnother interesting problem was raised that has a much tighter user base but exposes an interesting problem. In case we\ndon\u0026rsquo;t want to use wheels, and we provide only via source distribution, how should we resolve the problem of how we\nprovide the build backend\u0026rsquo;s build backend? For example, \u003ccode\u003esetuptools\u003c/code\u003e packages itself via \u003ccode\u003esetuptools\u003c/code\u003e. So were\n\u003ccode\u003esetuptools\u003c/code\u003e specify this via PEP-517, the build frontend would be put inside an infinite loop.\u003c/p\u003e\n\u003cp\u003eTo install the library \u003ccode\u003epugs\u003c/code\u003e it would first try to create an isolated environment. This environment needs \u003ccode\u003esetuptools\u003c/code\u003e,\nso the build frontend will need to build a wheel to satisfy it. The wheel build would itself trigger the creation of an\nisolated environment, which has build dependency again \u003ccode\u003esetuptools\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eHow to break this loop? Mandate all build backends must be exposed as wheels? Allow backends that can build themselves?\nShould these self-build backends allow to take on dependencies? There\u0026rsquo;s a long discussion with various options, pros and\ncons, so if you\u0026rsquo;re interested, make sure to head over the\n\u003ca href=\"https://discuss.python.org/t/pep-517-backend-bootstrapping/789\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epython Discourse board\u003c/a\u003e and give your opinion.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/growing-pain/many_pug_hu_ea389ae5197eb88b.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/growing-pain/many_pug_hu_8020c5ceaa728414.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/growing-pain/many_pug.webp\" alt=\"Many pugs\"\n        width=\"700\" height=\"525\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"conclusion\"\u003e\n  Conclusion\n  \u003ca class=\"heading-link\" href=\"#conclusion\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003ePackaging is hard. Improving a packaging system without any breakage where users can write and run arbitrary code during\nthe packaging in their free time is probably impossible. With PEP-518, though now build dependencies are explicit and\nbuild environments easy to create. With PEP-517, we can start moving into a more declarative packaging namespace that\nallows less space for users to make mistakes and provide better messages when things inevitably go wrong. Granted, as we\ngo through these changes, some packages might break, and we might disallow some practices that worked until now. We\n(PyPa maintainers) don\u0026rsquo;t do it in bad faith, so when errors do pop up please do fill in a detailed error report with\nwhat went wrong, how you tried to use it, and what is your use case.\u003c/p\u003e\n\u003cp\u003eWe\u0026rsquo;re trying to improve the packaging ecosystem genuinely. As such, we\u0026rsquo;ve created the\n\u003ca href=\"https://github.com/pypa/integration-test\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eintegration-test\u003c/a\u003e repository, as an effort to ensure that in the future, we\ncan catch at least some of these edge cases before they land on your machine. If you have any suggestion or requirements\nfor any part of the packaging feel free to start a discussion on the\n\u003ca href=\"https://discuss.python.org/c/packaging/14\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eDiscuss Python forums\u003c/a\u003e packaging section, or open an issue for the relevant\ntool at hand.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003cimg src=\"/posts/growing-pain/final_pug.webp\" alt=\"Pug saying goodbye\"\n        width=\"480\" height=\"600\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eThat\u0026rsquo;s all for now. Thanks for reading through it all! I would like to thank\n\u003ca href=\"https://twitter.com/pganssle\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePaul Ganssle\u003c/a\u003e for reviewing the packaging series post, and\n\u003ca href=\"https://twitter.com/techatbloomberg\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eTech At Bloomberg\u003c/a\u003e for allowing me to do open source contributions during my\nworking hours.\u003c/p\u003e\n","date_published":"2019-02-07T13:41:03Z","date_modified":"2026-02-15T09:30:25-08:00","tags":["python","packaging","pip","setuptools","pep517","pep518"]},{"id":"https://bernat.tech/posts/pep-517-518/","url":"https://bernat.tech/posts/pep-517-518/","title":"Python packaging - Past, Present, Future","content_html":"\u003cp\u003eHave you ever wondered what happens exactly when you run pip install? This post will give you a detailed overview of the\nsteps involved in the past, and how it all changes with the adoption of PEP-517 and PEP-518.\u003c/p\u003e\n\u003cp\u003e[In my previous post](https://bernat.tech/posts/pep-517-and-python-packaging/) I\u0026rsquo;ve described how it\u0026rsquo;s possible to install three\ntypes of content: source tree, source distribution, and wheels. Only the last two types are uploaded to PyPI, the\ncentral Python repository. However, one could get its hands on a source tree (by feeding, for example, a git protocol\nfor pip). The advantage of wheels over the others is that it does not require any build operation to happen on the user\nmachine; it\u0026rsquo;s just downloading and extract.\u003c/p\u003e\n\u003ch2 id=\"building-python-packages\"\u003e\n  Building python packages\n  \u003ca class=\"heading-link\" href=\"#building-python-packages\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eNow independent of where the build happens (user or the developer machine), you still need to build the package (either\nthe sdist or wheel). To do this, you need some builders in place. Historically, the need for third-party packages\nmanifested itself early on. Following the principle that Python has batteries included in the year 2000 with Python 1.6,\nthe \u003ca href=\"https://packaging.python.org/key_projects/#distutils\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003edistutils\u003c/a\u003e package was added to the Python standard library.\nIt introduced the concept of the \u003ccode\u003esetup.py\u003c/code\u003e file containing the build logic and is triggered via \u003ccode\u003epython setup.py cmd\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eIt allowed users to package code as libraries but did not have features such as declaration and automatic installation\nof dependencies. Furthermore, its improvement lifecycle was directly tied to the core interpreter release cycle. In 2004\n\u003ccode\u003esetuptools\u003c/code\u003e was created, built on top of \u003ccode\u003edistutils\u003c/code\u003e, and extended with other excellent features. It quickly became so\nprevalent that most python installations started to provide it together with the core interpreter itself.\u003c/p\u003e\n\u003cp\u003eBack in those days, all packages were source distributions. Wheel distributions came along a lot later, in 2014.\n\u003cem\u003edistutils\u003c/em\u003e was created back when only a few highly proficient people did the packaging. It is very flexible and\nimperative; you write a python script to modify every step in the package generation process.\u003c/p\u003e\n\u003cp\u003eThe downside of this, though, is that it\u0026rsquo;s anything but easy to learn and understand. This started to become more and\nmore an issue as Python grew in popularity and we had more and more users who were less proficient in the inner workings\nof Python.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003cimg src=\"/posts/pep-517-518/smart_pug.webp\" alt=\"Smart pug\"\n        width=\"400\" height=\"600\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"build-requirements\"\u003e\n  build requirements\n  \u003ca class=\"heading-link\" href=\"#build-requirements\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eFor installing a source distribution pip mostly \u003cstrong\u003edid\u003c/strong\u003e the following:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ediscover the package\u003c/li\u003e\n\u003cli\u003edownload the source distribution and extract it\u003c/li\u003e\n\u003cli\u003erun \u003ccode\u003epython setup.py install\u003c/code\u003e on the extracted folder (does a build + install).\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eDevelopers did \u003ccode\u003epython setup.py sdist\u003c/code\u003e to generate the distribution and \u003ccode\u003epython setup.py upload\u003c/code\u003e to upload it to a\ncentral repository (the upload command has been deprecated with 2013 in favor of the\n\u003ca href=\"https://pypi.org/project/twine/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etwine\u003c/a\u003e tool most notably due to the upload using a non-secure HTTP connection, and\nupload command also did a fresh build, not allowing the end-user to inspect the generated package before the actual\nupload).\u003c/p\u003e\n\u003cp\u003eWhen pip ran the \u003ccode\u003epython setup.py install\u003c/code\u003e, it did so with the python interpreter for which it was installing the\npackage. As such the build operation had access to all third-party packages already available inside that interpreter.\nMost notably, it used exactly the \u003cem\u003esetuptools\u003c/em\u003e version that was installed on the host python interpreter. If a package\nused a \u003cem\u003esetuptools\u003c/em\u003e feature available on a newer release than currently installed, the only way one could complete the\ninstallation was to update first the installed \u003cem\u003esetuptools.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eThis potentially can cause problems if a new release contained a bug that broke other packages. It is especially\ntroublesome on systems where the users can\u0026rsquo;t alter installed packages. Then there was also the problem of what happens\nwhen the builder (e.g., setuptools) wants to use other helper packages, such as cython.\u003c/p\u003e\n\u003cp\u003eIf any of these helpers were missing the build usually just broke with a failed to import package error:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-Python\" data-lang=\"Python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003eFile\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;setup_build.py\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"mi\"\u003e99\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003erun\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eCython.Build\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003ecythonize\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"ne\"\u003eImportError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNo\u003c/span\u003e \u003cspan class=\"n\"\u003emodule\u003c/span\u003e \u003cspan class=\"n\"\u003enamed\u003c/span\u003e \u003cspan class=\"n\"\u003eCython\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBuild\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThere was no way to provide such build dependencies from the developers\u0026rsquo; side. It also meant that users needed to\ninstall all packaging build dependencies even if they did not want to use that at runtime. To solve this issue\n\u003ca href=\"https://peps.python.org/pep-0518/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-518\u003c/a\u003e was created.\u003c/p\u003e\n\u003cp\u003eThe idea is that instead of using the host python with its currently installed packages for the build, the package\nprovides the ability to be explicit about what they need for their build operation. Instead of making this available on\nthe host python, we create an isolated python (think of a virtual environment) to run the packaging command.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epython setup.py install\u003c/code\u003e now becomes:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ecreate a temporary folder\u003c/li\u003e\n\u003cli\u003ecreate an isolated (from the third-party \u003ccode\u003esite-packages\u003c/code\u003e) python environment \u003ccode\u003epython -m virtualenv our_build_env\u003c/code\u003e,\nlet\u0026rsquo;s refer to this python executable as \u003ccode\u003epython_isolated\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003einstall the build dependencies\u003c/li\u003e\n\u003cli\u003egenerate a wheel we can install via \u003ccode\u003epython_isolated setup.py bdist_wheel\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eextract wheel to site packages of \u003ccode\u003epython\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWith this we can install packages that depend on \u003ccode\u003ecython\u003c/code\u003e without actually installing \u003ccode\u003ecython\u003c/code\u003e inside the runtime python\nenvironment. The file and method of specifying the build dependencies is the \u003ccode\u003epyproject.toml\u003c/code\u003e metadata file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-toml\" data-lang=\"toml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuild-system\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;setuptools\u0026gt;=44\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;wheel\u0026gt;=0.30.0\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"s2\"\u003e\u0026#34;cython\u0026gt;=0.29.4\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFurthermore, this also allows for whoever does the packaging to be explicit about what minimum versions they require for\nthe packaging and these can be quickly provisioned via pip transparently on the user machines.\u003c/p\u003e\n\u003cp\u003eThe same mechanism can also be used when generating the source distribution or the wheel on the developers\u0026rsquo; machine.\nWhen one invokes the \u003ccode\u003epip wheel . --no-deps\u003c/code\u003e command that will automatically create in the background an isolated python\nthat satisfies the build systems dependencies, and then call inside that environment the \u003ccode\u003epython setup.py bdist_wheel\u003c/code\u003e\nor \u003ccode\u003epython setup.py sdist\u003c/code\u003e command.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003cimg src=\"/posts/pep-517-518/jump_pug.webp\" alt=\"Jumping pug\"\n        width=\"400\" height=\"600\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"packaging-tool-diversity\"\u003e\n  packaging tool diversity\n  \u003ca class=\"heading-link\" href=\"#packaging-tool-diversity\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eNow there\u0026rsquo;s one more problem here, though. Note all these operations still go through the mechanism introduced twenty\nyears ago, aka executing \u003ccode\u003esetup.py\u003c/code\u003e. The whole ecosystem still builds on the top of the \u003cem\u003edistutils\u003c/em\u003e and \u003cem\u003esetuptools\u003c/em\u003e\ninterface that cannot change much due to trying to preserving backward compatibility.\u003c/p\u003e\n\u003cp\u003eAlso, executing arbitrary user-side Python code during packaging though is dangerous, leading to subtle errors hard to\ndebug by less experienced users. Imperative build systems were great for flexibility twenty years ago when we were not\naware of all the use cases. Still, now that we have a good understanding, we can probably make very robust and easy\npackage builders for various use cases.\u003c/p\u003e\n\u003cp\u003eTo quote \u003ca href=\"https://twitter.com/pganssle\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePaul Ganssle\u003c/a\u003e (maintainer of \u003ccode\u003esetuptools\u003c/code\u003eand \u003ccode\u003edateutil\u003c/code\u003e on this):\u003c/p\u003e\n\u003cblockquote\u003e\n    \u003cp\u003eIdeally, the default option would be a declarative build configuration that works well for the 99% case, with an\noption to fall back to an imperative system when you need the flexibility. At this point, it\u0026rsquo;s feasible for us to move\nto a world where it\u0026rsquo;s considered a code smell if you find you need to reach for the imperative build options.\u003c/p\u003e\n\n  \u003c/blockquote\u003e\u003cblockquote\u003e\n    \u003cp\u003eThe biggest problem with \u003ccode\u003esetup.py\u003c/code\u003e is that most people use it declaratively, and when they use it imperatively, they\ntend to introduce bugs into the build system. One example of this: if you have a Python 2.7-only dependency, you may\nbe tempted to specify it conditionally with \u003ccode\u003esys.version\u003c/code\u003e in your \u003ccode\u003esetup.py\u003c/code\u003e, but \u003ccode\u003esys.version\u003c/code\u003e only refers to the\ninterpreter that \u003cem\u003eexecuted\u003c/em\u003e the build; instead, you should be using the declarative environment markers for your\ninstall requirements.\u003c/p\u003e\n\n  \u003c/blockquote\u003e\u003cp\u003e\u003ca href=\"https://pypi.org/project/flit/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eflit\u003c/a\u003e proved this assumption correct already with its introduction in 2015. It has\nbecome the favorite packaging tool for many newcomers to Python, making sure new users avoid many foot guns. However, to\nget to this point, \u003ccode\u003eflit\u003c/code\u003e had to again build on top of \u003cem\u003edistutils\u003c/em\u003e/\u003cem\u003esetuptools,\u003c/em\u003e which makes its implementation\nnon-trivial, and the codebase quite a few shim layers (it still generates the \u003ccode\u003esetup.py\u003c/code\u003e file, for example, for its\nsource distributions).\u003c/p\u003e\n\u003cp\u003eIt\u0026rsquo;s time to free it from these shackles and encourage other people to build their packaging tools that make packaging\neasy for their use cases, making \u003ccode\u003esetup.py\u003c/code\u003e the exception rather than the default.\n\u003ca href=\"https://github.com/pypa/setuptools/pull/1675\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003esetuptools\u003c/code\u003e plans to offer a \u003ccode\u003esetup.cfg\u003c/code\u003e\u003c/a\u003e the only user interface to\nlead the way, and when a PEP-517 system is in place, you should prefer that overusing the \u003ccode\u003esetup.py\u003c/code\u003e for most cases. To\nnot tie everything back to \u003ccode\u003esetuptools\u003c/code\u003e and \u003ccode\u003edistutils\u003c/code\u003e and facilitate the creation of new-build backends\n\u003ca href=\"https://peps.python.org/pep-0517/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-517\u003c/a\u003e was created. It separates builders into a backend and frontend. The\nfrontend provides an isolated python environment satisfying all the declared build dependencies; the backend provides\nhooks that the frontend can call from its isolated environment to generate either a source distribution or wheel.\u003c/p\u003e\n\u003cp\u003eFurthermore, instead of talking with the backend via the \u003ccode\u003esetup.py\u003c/code\u003e file and its commands, we move to python modules and\nfunctions. All packaging backends must provide a python object API that implements two methods\n\u003ca href=\"https://peps.python.org/pep-0517/#build-wheel\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ebuild_wheel\u003c/a\u003e and \u003ca href=\"https://peps.python.org/pep-0517/#id9\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ebuild_sdist\u003c/a\u003e at\nthe minimum. The API object point is specified via the \u003ccode\u003epyproject.toml\u003c/code\u003e file under the \u003ccode\u003ebuild-backend\u003c/code\u003e key:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-toml\" data-lang=\"toml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebuild-system\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003erequires\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;flit\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ebuild-backend\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;flit.api:main\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe above code effectively means for the frontend that you can get hold of the backend by running the above code inside\nthe isolated python environment:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eflit.api\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ebackend\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eflit\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapi\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# build wheel via\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ebackend\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebuild_wheel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# build source distribution via\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ebackend\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebuild_sdist\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIt\u0026rsquo;s up to the backend where and how they want to expose their official API:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://flit.readthedocs.io/en/latest/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eflit\u003c/a\u003e does it via \u003ccode\u003eflit.buildapi\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://setuptools.readthedocs.io/en/latest/history.html#v40-8-0\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003esetuptools\u003c/a\u003e provides two variants:\n\u003ccode\u003esetuptools.build_meta\u003c/code\u003e (on why read on later)\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://poetry.eustace.io/docs/pyproject/#poetry-and-pep-517\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epoetry\u003c/a\u003e does it via \u003ccode\u003epoetry.masonry.api\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eWith this, we can start having packaging tools that are no longer bound to the legacy decisions of the \u003ccode\u003edistutils\u003c/code\u003e in\nthe frontend.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003cimg src=\"/posts/pep-517-518/curious_pug.webp\" alt=\"Curious pug\"\n        width=\"400\" height=\"600\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch1 id=\"tox-and-packaging\"\u003e\n  tox and packaging\n  \u003ca class=\"heading-link\" href=\"#tox-and-packaging\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"https://tox.readthedocs.io/en/latest/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etox is testing tool\u003c/a\u003e and used by most projects to ensure compatibility against\nmultiple Python interpreter versions of a given package. It also allows the quick creation of Python environments with\nthe package under inspection installed in it, making reproducing failures faster.\u003c/p\u003e\n\u003cp\u003eTo be able to test a package, it first needs to build a source distribution, though. While both PEP-518 and PEP-517\nshould make things better, turning them on can break packaging under some use cases. Therefore when\n\u003ca href=\"https://tox.readthedocs.io/en/latest/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003etox\u003c/code\u003e\u003c/a\u003e added isolated build in version\n\u003ca href=\"https://tox.readthedocs.io/en/latest/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003e3.3.0\u003c/code\u003e\u003c/a\u003e decided not to enable it by default, for now. You need to enable it\nmanually (it will be turned on by default in version \u003ccode\u003e4\u003c/code\u003e sometime later this year - 2021).\u003c/p\u003e\n\u003cp\u003eOnce you\u0026rsquo;ve specified a \u003ccode\u003epyproject.toml\u003c/code\u003e with appropriate \u003ccode\u003erequires\u003c/code\u003e and \u003ccode\u003ebuild-backend\u003c/code\u003e, you need to turn on the\n\u003ccode\u003eisolated_build\u003c/code\u003e flag inside \u003ccode\u003etox.ini\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-ini\" data-lang=\"ini\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003e[tox]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"na\"\u003eisolated_build\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003eTrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAfter this, tox in the \u003ca href=\"https://tox.readthedocs.io/en/latest/#system-overview\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epackaging phase\u003c/a\u003e will build the source\ndistribution (by providing the build dependencies into an isolated python environment as per PEP-518). Afterward will\ncall the build backend as stated in PEP-517. Otherwise, tox will use the old way of building source distributions,\ninvoking the \u003ccode\u003epython setup.py sdist\u003c/code\u003e command with the same interpreter tox is installed into.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/pep-517-518/moody_pug_hu_12215429623f9b66.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/pep-517-518/moody_pug_hu_94a4de09c68b721d.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/pep-517-518/moody_pug.webp\" alt=\"Moody pug\"\n        width=\"700\" height=\"467\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"conclusion\"\u003e\n  Conclusion\n  \u003ca class=\"heading-link\" href=\"#conclusion\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eThe Python Packaging Authority hopes that all this makes sense and will have more user-friendly, error-proof and stable\nbuilds. The specifications for these standards were written up and debated in long threads between 2015 and 2017. The\nproposals were deemed good enough to benefit the most, but some less mainstream use cases could have been overlooked.\u003c/p\u003e\n\u003cp\u003eIf your use case is such, don\u0026rsquo;t worry the PEPs are open to enhancement at any point if we deem required. [In my next\npost of this series here](https://bernat.tech/posts/growing-pain/) I\u0026rsquo;ll go over some of the pain points the community bumped into\nwhile releasing these two PEPs. These should serve as lessons learned and show that there\u0026rsquo;s still some work to be done.\nIt\u0026rsquo;s not everything perfect yet. However, we\u0026rsquo;re getting better. Join the packaging community if you can help out, and\nlet\u0026rsquo;s make things better together!\u003c/p\u003e\n","date_published":"2019-02-07T13:40:59Z","date_modified":"2026-02-15T09:30:25-08:00","tags":["python","pip","install","packaging","setuptools","pep517","pep518"]},{"id":"https://bernat.tech/posts/pep-517-and-python-packaging/","url":"https://bernat.tech/posts/pep-517-and-python-packaging/","title":"The state of Python Packaging","content_html":"\u003cp\u003epip 19.0 has been released on 22nd January 2019. On the feature list, most notably, it now supports PEP-517, which by\ndefault is turned \u003cstrong\u003eon\u003c/strong\u003e when that the project has a \u003ccode\u003epyproject.toml\u003c/code\u003e at the root folder. The PEP in question has been\ncreated in 2015 and accepted in 2017. Even though it took a while until pip implemented it, the release and the issues\nthat followed confirmed that many people are not familiar with it. Read on if you want to get a picture of how the\nPython packaging ecosystem evolved today and where we hope to see it down the line. We expect that even though the\nintroduction of the aforementioned python enhancement proposal may cause some discomfort, we will benefit from it in the\nlong term.\u003c/p\u003e\n\u003cp\u003eI joined the Python open-source community around three years ago (though I have used it for more than 8 years). I\u0026rsquo;ve\nremarked that the Python packaging has a reputation of a somewhat black box from the early days. There are many unknown\nparts, and people mostly get by with just copying other projects, build configurations, and roll with them. On my path\nto better understanding this black box and improving it, I\u0026rsquo;ve become the maintainer of both the virtualenv and tox\nproject, occasionally contributing to both \u003ccode\u003esetuptools\u003c/code\u003e and \u003ccode\u003epip\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eAs I hope to give an exhausting (hopefully still a relatively high level) overview of the subject, I decided to split it\nup into three posts. In this first post, I will give a broad overview of how Python packaging works and the type of\npackages it has. In a subsequent post, I will present in detail how the installation of packages works and how\nPEP-517/518 tries to improve on it. Finally, I dedicate a whole other post to explain some of the painful lessons we\nlearned while introducing these improvements. A heads up, I will focus mainly on the Python Packaging Authorities\nsystems (\u003ccode\u003epip\u003c/code\u003e, \u003ccode\u003esetuptools\u003c/code\u003e, so no \u003ccode\u003econda\u003c/code\u003e or operating system-specific packagers).\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/pep-517-and-python-packaging/sad_pug_hu_9e75fa8849d4a989.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/pep-517-and-python-packaging/sad_pug_hu_2c310c7e3a7f8e56.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/pep-517-and-python-packaging/sad_pug.webp\" alt=\"Sad pug\"\n        width=\"700\" height=\"468\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch1 id=\"an-example-project\"\u003e\n  An example project\n  \u003ca class=\"heading-link\" href=\"#an-example-project\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eTo tell this story, I\u0026rsquo;ll need to tell how to distribute python packages; more specifically, explain how to package\ninstallation worked in the past and how we hope it will work in the future. To have a concrete example of what to\ndemonstrate, let me introduce my excellent example library: \u003ccode\u003epugs\u003c/code\u003e. This library reasonably simple: it generates a\nsingle package called \u003ccode\u003epugs\u003c/code\u003e containing only a single module called \u003ccode\u003elogic\u003c/code\u003e. The logic is to generate random quotes, you\nguessed right, about \u003cem\u003epugs\u003c/em\u003e. Here\u0026rsquo;s a simple example structure of it viewed as a source tree (also available under\n\u003ca href=\"https://github.com/gaborbernat/pugs\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003egaborbernat/pugs\u003c/a\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epugs-project\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── README.rst\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── setup.cfg\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── setup.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── LICENSE.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── src\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│   └── pugs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│       ├── __init__.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│       └── logic.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── tests\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│   ├── test_init.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│   └── test_logic.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── tox.ini\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e└── azure-pipelines.yml\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe have four distinct content type here:\u003c/p\u003e\n\u003cp\u003eWhat would it mean for our \u003ccode\u003epugs\u003c/code\u003e package to be available on a user machine\u0026rsquo;s interpreter? Ideally, the user should be\nable to import it and call functions from it once it starts up the interpreter:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ethe business logic code (what\u0026rsquo;s inside the \u003ccode\u003esrc\u003c/code\u003e folder),\u003c/li\u003e\n\u003cli\u003ethe test code (\u003ccode\u003etests\u003c/code\u003e folder and \u003ccode\u003etox.ini\u003c/code\u003e),\u003c/li\u003e\n\u003cli\u003ethe packaging code and metadata (\u003ccode\u003esetup.py\u003c/code\u003e, \u003ccode\u003esetup.cfg\u003c/code\u003e, \u003ccode\u003eLICENSE.txt\u003c/code\u003e, \u003ccode\u003eREADME.rst\u003c/code\u003e - note we use nowadays the de\nfacto standard packaging tool \u003ca href=\"https://pypi.org/project/setuptools\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003esetuptools\u003c/a\u003e),\u003c/li\u003e\n\u003cli\u003efiles helping with project management and maintenance:\n\u003cul\u003e\n\u003cli\u003econtinuous-integration (\u003ccode\u003eazure-pipelines.yml\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eversion control (\u003ccode\u003e.git\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eproject management (for example, a potential \u003ccode\u003e.github\u003c/code\u003e folder).\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e \u003cspan class=\"mf\"\u003e3.7.2\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev3\u003c/span\u003e\u003cspan class=\"mf\"\u003e.7.2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"n\"\u003ea3ffc0492\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDec\u003c/span\u003e \u003cspan class=\"mi\"\u003e24\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e02\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e44\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e43\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eClang\u003c/span\u003e \u003cspan class=\"mf\"\u003e6.0\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eclang\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mf\"\u003e600.0.57\u003c/span\u003e\u003cspan class=\"p\"\u003e)]\u003c/span\u003e \u003cspan class=\"n\"\u003eon\u003c/span\u003e \u003cspan class=\"n\"\u003edarwin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;help\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;copyright\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;credits\u0026#34;\u003c/span\u003e \u003cspan class=\"ow\"\u003eor\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;license\u0026#34;\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003emore\u003c/span\u003e \u003cspan class=\"n\"\u003einformation\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epugs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epugs\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edo_tell\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s2\"\u003e\u0026#34;An enlightened pug knows how to make the best of whatever he has to work with - A Pug\u0026#39;s Guide to Dating -  Gemma Correll\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/pep-517-and-python-packaging/enlightened_pug_hu_d7661640dfbd971f.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/pep-517-and-python-packaging/enlightened_pug_hu_d9656d45932712d8.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/pep-517-and-python-packaging/enlightened_pug.webp\" alt=\"Enlightened pug\"\n        width=\"700\" height=\"468\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch1 id=\"python-package-availability\"\u003e\n  Python package availability\n  \u003ca class=\"heading-link\" href=\"#python-package-availability\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eHow does Python knows what\u0026rsquo;s available or not? The short answer is it does not. Not upfront, at least, that is. Instead,\nit will try to load and see if it succeeds dynamically. From where does it load it? There are many possible locations,\nbut in most cases, we are talking about loading it from a folder on the file system. Where is this folder? For a given\nmodule, one can print out the representation of the module to find out:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003epugs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epugs\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003emodule\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;pugs\u0026#39;\u003c/span\u003e \u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;/Users/bernat/Library/Python/3.7/lib/python/site-packages/pugs/__init__.py\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe folder under you\u0026rsquo;ll find it depends on:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ethe type of the package it is (third-party or built-in/aka part of the standard library)\u003c/li\u003e\n\u003cli\u003eif it\u0026rsquo;s globally or just for the current user available (see \u003ca href=\"https://peps.python.org/pep-0370/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-370\u003c/a\u003e),\u003c/li\u003e\n\u003cli\u003eand if it\u0026rsquo;s a system python or a virtual environment.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eGenerally speaking, though, for a given python interpreter, one can find a list of possible directories by printing out\nthe \u003ccode\u003esys.path\u003c/code\u003e variables content, for example, on my macOS:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003esys\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eLibrary\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eFrameworks\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eVersions\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e3.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003epython37\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezip\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eLibrary\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eFrameworks\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eVersions\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e3.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003epython3\u003c/span\u003e\u003cspan class=\"mf\"\u003e.7\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eLibrary\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eFrameworks\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eVersions\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e3.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003epython3\u003c/span\u003e\u003cspan class=\"mf\"\u003e.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003edynload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eUsers\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ebernat\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eLibrary\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e3.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003epython\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003esite\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003epackages\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eLibrary\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eFrameworks\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ePython\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframework\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eVersions\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"mf\"\u003e3.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003epython3\u003c/span\u003e\u003cspan class=\"mf\"\u003e.7\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003esite\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003epackages\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFor third-party packages, it\u0026rsquo;s going to be some \u003ccode\u003esite-packages\u003c/code\u003e folder. Note in the above example how there\u0026rsquo;s a\nsystem-wide and a user-specific instance of this. How do packages end up inside this folder? It must be put there by\nsome installer.\u003c/p\u003e\n\u003cp\u003eThe following diagram displays how most of the time things go:\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/pep-517-and-python-packaging/diagram_hu_46fc39cd0944e521.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/pep-517-and-python-packaging/diagram_hu_697fb3e41a71dcd2.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/pep-517-and-python-packaging/diagram.webp\" alt=\"Python packaging diagram\"\n        width=\"700\" height=\"425\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003col\u003e\n\u003cli\u003eThe developer writes some python code inside a folder (referred to as the source tree).\u003c/li\u003e\n\u003cli\u003eSome tool (such as \u003ccode\u003esetuptools\u003c/code\u003e) then takes the source tree and packages it up for redistribution.\u003c/li\u003e\n\u003cli\u003eThe generated package is uploaded via another tool (twine) to a central repository (usually\n\u003ca href=\"https://pypi.org\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ehttps://pypi.org\u003c/a\u003e) the end-user machine has access to.\u003c/li\u003e\n\u003cli\u003eThe end-user machine uses some installer that discovers, downloads, and installs the package in question. The\ninstallation operation boils down by creating the correct directory structure and metadata inside the \u003ccode\u003esite-packages\u003c/code\u003e\nfolder.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/pep-517-and-python-packaging/discover_pug_hu_18f474b5cff6df18.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/pep-517-and-python-packaging/discover_pug_hu_f731d5a9f88dfc52.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/pep-517-and-python-packaging/discover_pug.webp\" alt=\"Pug discovering something\"\n        width=\"700\" height=\"554\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch1 id=\"python-package-types\"\u003e\n  Python package types\n  \u003ca class=\"heading-link\" href=\"#python-package-types\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eA package during installation must generate at least two types of content to be put in the site package: a metadata\nfolder about the package contents the \u003ccode\u003e{package}-{version}.dist-info\u003c/code\u003e and the business logic files.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/Users/bernat/Library/Python/3.7/lib/python/site-packages/pugs\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── __init__.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── __pycache__\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│   ├── __init__.cpython-37.pyc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e│   └── logic.cpython-37.pyc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e└── logic.py\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e/Users/bernat/Library/Python/3.7/lib/python/site-packages/pugs-0.0.1.dist-info\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── INSTALLER\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── LICENSE.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── METADATA\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── RECORD\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── WHEEL\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e├── top_level.txt\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e└── zip-safe\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe distribution info folder describes the package: what installer was used to put it there, what license the package\nhas attached to it, what files were created as part of the installation process, what is the top-level python package,\nwhat entry points the package exposes and so on. A good description of each file can be found inside\n\u003ca href=\"https://peps.python.org/pep-0427/#id14\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-427\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eHow do we get from our source tree to these two content types? We have two distinct paths in front of us:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGenerate this directory structure and metadata from our source tree, compress it into a single file, and publish it\nto the central package repository. In this case, the installer has to download the package and extract it to the\n\u003ccode\u003esite-packages\u003c/code\u003e folder. We refer to this type of package as a \u003ccode\u003ewheel\u003c/code\u003e package.\u003c/li\u003e\n\u003cli\u003eAlternatively, you can create an archive containing the package source, build scripts and metadata required to\ngenerate the installable directory structure, then upload that to the central repository. This is called a source\ndistribution or \u003ccode\u003esdist\u003c/code\u003e. In this case, the installer has a lot more work to do, extracts the archive, runs the\nbuilder, and only then copies it over.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eThe difference between the two options is mainly about where the package \u003cem\u003ecompile/build\u003c/em\u003e operation happens: the\ndevelopers\u0026rsquo; machine or the end-users machine. If it occurs on the developers\u0026rsquo; side (such as wheels), the installation\nprocess is very lightweight. Everything has already been done on the developer machine side. The user machine side\noperation is just a simple download and decompress.\u003c/p\u003e\n\u003cp\u003eIn our case, we used \u003ccode\u003esetuptools\u003c/code\u003e as our builder (the part that generates from the source tree the content to be put\ninside the site-packages folder). Therefore, to perform the build operation on the user machine, we would need to ensure\nthat an \u003cem\u003eappropriate\u003c/em\u003e version of \u003ccode\u003esetuptools\u003c/code\u003e is available on the user machine (if you\u0026rsquo;re using a feature from version\n\u003ccode\u003e40.6.0\u003c/code\u003e you must guarantee that the user has at least that version).\u003c/p\u003e\n\u003cp\u003eAnother use case to consider is that Python offers access to C/C++ libraries from within Python (to get that extra\nperformance where you need it). Packages that do so are referred to as C-extension packages, as they take advantage of\nthe C-extension API CPython offers.\u003c/p\u003e\n\u003cp\u003eSuch extensions to work though, need to C/C++ compile their functionality against both the C/C++ library they interact\nwith and the current Python interpreters C-API library. In these cases, the build operation involves calling a binary\ncompiler, not just metadata and folder structure generation as was the case with pure python packages (such as our\n\u003ccode\u003epugs\u003c/code\u003e library was).\u003c/p\u003e\n\u003cp\u003eIf the build happens on the user machine, one needs to ensure that the correct libraries and compilers are also\navailable at build time. This is now a much harder job, as these are platform-specific binaries distributed via the\nplatform\u0026rsquo;s packaging tools. The lack or version miss-match of these libraries often triggers cryptic errors during the\nbuild, which leaves users frustrated and puzzled.\u003c/p\u003e\n\u003cp\u003eTherefore, if possible, always prefer packaging your package as a \u003cstrong\u003e\u003cem\u003ewheel\u003c/em\u003e\u003c/strong\u003e. This will altogether avoid the problem of\nusers not having all the correct build dependencies (both pure python types such as setuptools or binary ones as is the\nC/C++ compiler). Even if those build dependencies are easy to provision (such as in the case of pure python builders -\ne.g. setuptools) you can save install time by avoiding this step entirely.\u003c/p\u003e\n\u003cp\u003eThat being said they are still two use cases that warrant providing source distributions (even when you provide a\nwheel):\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eC-extension source distributions tend to be more auditable, as one can read the source code and thus offer greater\ntransparency in what it offers: many big corporate environments prefer using these over wheels for this sole reason\n(they generally extend the rule to pure python wheels, mostly to avoid the need of categorizing what is pure python\nwheel and what is not).\u003c/li\u003e\n\u003cli\u003eYou might not be able to provide a wheel for every possible platform out there (especially true in case of\nc-extension packages), in this case, the source distribution may allow these platforms to generate the wheel\nthemselves.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"conclusion\"\u003e\n  Conclusion\n  \u003ca class=\"heading-link\" href=\"#conclusion\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eThe difference between a source tree, a source distribution, and a wheel:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003esource tree \u003cem\u003e-\u003c/em\u003e\u003c/strong\u003e contains all project files available on the developers\u0026rsquo; machine/repository (business logic, tests,\npackaging data, CI files, IDE files, SVC, etc.) - for example, see example project above.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003esource distribution\u003c/strong\u003e - contains code files required to build a wheel (business logic + packaging data + often also\nthe unit tests files to validate the build; notably lacks developer environment content such as CI/IDE/version control\nfiles) - format: \u003ccode\u003epugs-0.0.1.tar.gz\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003ewheel\u003c/strong\u003e - contains the package metadata and source files to be put into the \u003ccode\u003esite-packages\u003c/code\u003e folder - format:\n\u003ccode\u003epugs-0.0.1-py2.py3-none-any.whl\u003c/code\u003e.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/pep-517-and-python-packaging/smart_pug_hu_4ab5df6b25f602bc.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/pep-517-and-python-packaging/smart_pug_hu_a239ae4645d0da08.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/pep-517-and-python-packaging/smart_pug.webp\" alt=\"Smart pug\"\n        width=\"600\" height=\"614\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003e[Read the next post of the series here](https://bernat.tech/posts/pep-517-518/) to determine what happens when we install a\npackage. Thanks for reading!\u003c/p\u003e\n","date_published":"2019-02-07T13:40:54Z","date_modified":"2026-02-15T09:30:25-08:00","tags":["python","packaging","pip","setuptools","pep517","pep518","wheel","sdist"]},{"id":"https://bernat.tech/posts/the-state-of-type-hints-in-python/","url":"https://bernat.tech/posts/the-state-of-type-hints-in-python/","title":"The state of type hints in Python","content_html":"\u003cp\u003eOne of the main selling points for Python is that it is dynamically-typed. There is no plan to change this.\nNevertheless, in September 2014 \u003ca href=\"https://twitter.com/gvanrossum\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eGuido van Rossum\u003c/a\u003e (Python\n\u003ca href=\"https://en.wikipedia.org/wiki/Benevolent_dictator_for_life\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eBDFL\u003c/a\u003e) created a python enhancement proposal\n(\u003ca href=\"https://peps.python.org/pep-0484/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-484\u003c/a\u003e) to add type hints to Python. It has been released for general usage a\nyear later, in September 2015, as part of Python \u003ccode\u003e3.5.0\u003c/code\u003e.\n\u003ca href=\"http://python-history.blogspot.com/2009/01/brief-timeline-of-python.html\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eTwenty-five years into its existence\u003c/a\u003e now\nthere was a standard way to add type information to Python code. In this blog post, I\u0026rsquo;ll explore how the system matured,\nhow you can use it, and what\u0026rsquo;s next for type hints.\u003c/p\u003e\n\u003cp\u003eDisclaimer: throughout this blog post, you\u0026rsquo;ll see many seals and penguin pictures. The reason for this is mostly my\nadmiration for these animals, and hey, nothing like some cute animals to help digest some tricky topics, not?\u003c/p\u003e\n\u003ch1 id=\"why-do-we-need-this\"\u003e\n  Why do we need this?\n  \u003ca class=\"heading-link\" href=\"#why-do-we-need-this\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/why_hu_e32631b467db0235.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/why_hu_e0deed3d1627845f.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/why.webp\" alt=\"Seal asking why\"\n        width=\"700\" height=\"525\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch2 id=\"what-it-was-designed-to-do\"\u003e\n  What it was designed to do?\n  \u003ca class=\"heading-link\" href=\"#what-it-was-designed-to-do\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eFirst, let\u0026rsquo;s see why do we need type hints in Python. There are multiple advantages of this, and I\u0026rsquo;ll try to enumerate\nit in their order of importance:\u003c/p\u003e\n\u003ch3 id=\"1-easier-to-reason-about-code\"\u003e\n  1. Easier to reason about code\n  \u003ca class=\"heading-link\" href=\"#1-easier-to-reason-about-code\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eKnowing the type of parameters makes it a lot easier to understand and maintain a codebase. For example, let\u0026rsquo;s assume\nyou have a function. While we know the types of the parameters at the time of creating the function, a few months down\nthe line, this is no longer the case. Having stated the types of all parameters and return types right beside the code\ncan speed up significantly the time required to catch up with a code snippet. Always remember that code you read code a\nlot more often than you write it. Therefore you should optimize for ease of reading.\u003c/p\u003e\n\u003cp\u003eHaving type hints informs you of what parameter types you need to pass on when calling a function and when you need to\nextend/modify the function tells you about the type of data you get both as input and output. For example, imagine the\nfollowing the send request function,\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esend_request\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003erequest_data\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eOptional\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDict\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e]],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003euser_id\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eOptional\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eas_json\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eJust looking at the signature of this, I know that while the \u003ccode\u003erequest_data\u003c/code\u003e could be anything, the \u003ccode\u003eheaders\u003c/code\u003e content is\na dictionary of strings. The user information is optional (defaulting to \u003ccode\u003eNone\u003c/code\u003e), or it needs to be whatever \u003ccode\u003eUserId\u003c/code\u003e\nencodes it too. The contract for \u003ccode\u003eas_json\u003c/code\u003e is that it needs to be always a boolean value, being a flag essentially even\nthough the name might not suggest that at first.\u003c/p\u003e\n\u003cp\u003eThe truth is many of us already understand that type of information is essential. However, in lack of better options\nuntil now, this was often mentioned inside the docstring. The type hint system moves this closer to the function\ninterface and provides a well-defined way to declare complex type requirements. Building linters that can check these\ntype hint constraints ensure that they never become out of date, granted that you run them after every code change.\u003c/p\u003e\n\u003ch3 id=\"2easier-refactoring\"\u003e\n  2.Easier refactoring\n  \u003ca class=\"heading-link\" href=\"#2easier-refactoring\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eType hints make it trivial to find where a given class is used when you\u0026rsquo;re trying to refactor your codebase. While many\nIDEs already have some heuristic in place to achieve this. Type hints allow them to have \u003ccode\u003e100%\u003c/code\u003e detection and accuracy\nratio. Generally offers a smoother and more accurate detection of how types run through your code. Remember, while\ndynamic typing means any variable can become any of types, all your variables have at all time one and only one type.\nThe type system still is very much a core component of programming. Remember all the time you\u0026rsquo;ve used \u003ccode\u003eisinstance\u003c/code\u003e to\ndrive your application logic.\u003c/p\u003e\n\u003ch3 id=\"3-easier-to-use-libraries\"\u003e\n  3. Easier to use libraries\n  \u003ca class=\"heading-link\" href=\"#3-easier-to-use-libraries\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eHaving type hints mean IDEs can have a more accurate and smarter suggestion engine. Now when you invoke auto-complete,\nthe IDE knows with complete confidence, what methods/attributes are available on an object. Furthermore, if the user\ntries to call something non-existent or passes arguments of an incorrect type, the IDE can instantly warn about it.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/editor_suggest_hu_aa03d44631d9a37.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/editor_suggest_hu_5003627f3aff6bd6.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/editor_suggest.webp\" alt=\"IDE suggestion\"\n        width=\"500\" height=\"225\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"4-type-linters\"\u003e\n  4. Type linters\n  \u003ca class=\"heading-link\" href=\"#4-type-linters\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/type_mismatch_hu_ba6a63f0cc145c38.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/type_mismatch_hu_c9f9874cfa53e93c.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/type_mismatch.webp\" alt=\"Type mismatch warning\"\n        width=\"500\" height=\"181\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eWhile the IDE suggesting incorrect argument types is excellent, an extension of this is to have a linter tool that makes\nsure that type wise the logic of your application is sound. Running this tool can help you catch bugs early on (e.g., in\nthe example that follows, the input must be of type \u003ccode\u003estr\u003c/code\u003e, passing in \u003ccode\u003eNone\u003c/code\u003e throws an exception):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;transformed value \u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupper\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# if arg would be type hinted as str the type linter could warn that this is an invalid call\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhile in this trivial case, some could argue that it\u0026rsquo;s easy to see the mismatch, remember this works in more complicated\ncases too, where such mismatches get harder and harder to see; such as nested function calls:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003econstruct\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e \u003cspan class=\"ow\"\u003eis\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earg\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003earg\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34; appended\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econstruct\u003c/span\u003e\u003cspan class=\"p\"\u003e()))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhile there are more and more linters out there, the reference implementation of the Python type checking is\n\u003ca href=\"http://mypy-lang.org/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003emypy\u003c/a\u003e. mypy is a Python command-line application, making it easy to integrate into a continuous\nintegration pipeline.\u003c/p\u003e\n\u003ch3 id=\"5-runtime-data-validation\"\u003e\n  5. Runtime data validation\n  \u003ca class=\"heading-link\" href=\"#5-runtime-data-validation\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eType hints can be used to validate at runtime to ensure that the caller does not break the contract of methods. It is no\nlonger needed to start your function with a long list of type asserts; instead, use a framework that re-uses type hints\nand automatically checks that they are meet before your business logic runs (for example, with\n\u003ca href=\"https://github.com/samuelcolvin/pydantic\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epydantic\u003c/a\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003edatetime\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003epydantic\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eBaseModel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eValidationError\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eBaseModel\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;John Doe\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esignup_ts\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edatetime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efriends\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eexternal_data\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;123\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;signup_ts\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;2017-06-01 12:22\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;friends\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003euser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003eexternal_data\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esignup_ts\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;broken\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003efriends\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;not number\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eexcept\u003c/span\u003e \u003cspan class=\"n\"\u003eValidationError\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"what-it-wasnt-designed-to-do\"\u003e\n  What it wasn\u0026rsquo;t designed to do?\n  \u003ca class=\"heading-link\" href=\"#what-it-wasnt-designed-to-do\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eFrom the get-go, Guido clearly stated that type hints are not meant to be used for the following use cases (of course\nthat does not mean that people do not have libraries/tools outside, which do just that - open source power for the\nwin!):\u003c/p\u003e\n\u003ch3 id=\"1-no-runtime-type-inference\"\u003e\n  1. No runtime type inference\n  \u003ca class=\"heading-link\" href=\"#1-no-runtime-type-inference\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eThe runtime interpreter (CPython) does not try to deduce type information at runtime and perhaps validate arguments\npassed around based on that.\u003c/p\u003e\n\u003ch3 id=\"2-no-performance-tuning\"\u003e\n  2. No performance tuning\n  \u003ca class=\"heading-link\" href=\"#2-no-performance-tuning\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eThe runtime interpreter (CPython) does not use the type of information to optimize the generated byte-code for either\nsecurity or performance. When executing a Python script type hints are treated just like comments; the interpreter\ndiscards it.\u003c/p\u003e\n\u003cp\u003eThe key takeaway should be that type hints are designed to improve developer experience, not influencing how your script\nevaluates. It creates happy developers, not faster code!\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/happy_programmer_hu_efd886726a89acf8.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/happy_programmer_hu_f7b979985975e24b.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/happy_programmer.webp\" alt=\"Happy programmer seal\"\n        width=\"700\" height=\"466\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch1 id=\"what-kind-of-type-system\"\u003e\n  What kind of type system?\n  \u003ca class=\"heading-link\" href=\"#what-kind-of-type-system\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003ePython has gradual type hinting, meaning that whenever for a given function or variable, the type hint is not specified.\nWe assume that it can have any type (that is, it remains a dynamically typed section). Use this to make your gradually\ncodebase type-aware, one function, or variable at a time. It is possible to type hint:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efunction arguments,\u003c/li\u003e\n\u003cli\u003efunction return values,\u003c/li\u003e\n\u003cli\u003evariables.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cem\u003eRemember only type hinted code is type-checked!\u003c/em\u003e When you run the linter (e.g., mypy) on a type hinted code, you\u0026rsquo;ll get\nerrors if there are type miss-matches:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# tests/test_magic_field.py\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicType\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDEFAULT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enames\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis code will generate the following output:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ebernat@uvm ~/python-magic \u003cspan class=\"o\"\u003e(\u003c/span\u003emaster●\u003cspan class=\"o\"\u003e)\u003c/span\u003e$ mypy --ignore-missing-imports tests/test_magic_field.py\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etests/test_magic_field.py:21: error: Argument \u003cspan class=\"m\"\u003e1\u003c/span\u003e to \u003cspan class=\"s2\"\u003e\u0026#34;MagicField\u0026#34;\u003c/span\u003e has incompatible \u003cspan class=\"nb\"\u003etype\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;int\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eexpected \u003cspan class=\"s2\"\u003e\u0026#34;Union[str, bytes]\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etests/test_magic_field.py:22: error: \u003cspan class=\"s2\"\u003e\u0026#34;MagicField\u0026#34;\u003c/span\u003e has no attribute \u003cspan class=\"s2\"\u003e\u0026#34;names\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e maybe \u003cspan class=\"s2\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e or \u003cspan class=\"s2\"\u003e\u0026#34;_name\u0026#34;\u003c/span\u003e?\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNote we can detect both type incompatibility for the argument passed in and accesses to inexistent attributes on\nobjects. The latter even suggests valid options available, making it easy to notice and fix typos.\u003c/p\u003e\n\u003ch2 id=\"how-to-add-it\"\u003e\n  How to add it\n  \u003ca class=\"heading-link\" href=\"#how-to-add-it\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eOnce you decide to add type hints, you\u0026rsquo;ll come to realize that you can add it in more than one way to the codebase.\nLet\u0026rsquo;s see what your options are.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/interested_hu_95c1c741d8df113d.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/interested_hu_911eb9cee3c648cd.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/interested.webp\" alt=\"Interested seal\"\n        width=\"700\" height=\"532\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch3 id=\"1-type-annotations\"\u003e\n  1. Type annotations\n  \u003ca class=\"heading-link\" href=\"#1-type-annotations\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cem\u003eType annotations\u003c/em\u003e is the straightforward way and is the one you\u0026rsquo;ll find mostly mentioned on the\n\u003ca href=\"https://docs.python.org/3/library/typing.html\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etyping\u003c/a\u003e documentation. It uses function annotations added to language\nvia \u003ca href=\"https://peps.python.org/pep-3107/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-3107\u003c/a\u003e (Python \u003ccode\u003e3.0+\u003c/code\u003e) and variable annotations via\n\u003ca href=\"https://peps.python.org/pep-0526/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-526\u003c/a\u003e (Python \u003ccode\u003e3.6+\u003c/code\u003e). These allow you to use the \u003ccode\u003e:\u003c/code\u003e syntax to attach\ninformation to variables and function arguments. The \u003ccode\u003e-\u0026gt;\u003c/code\u003e operator is used to attach information to the return value of\na function/method.\u003c/p\u003e\n\u003cp\u003eThe \u003cstrong\u003eupside\u003c/strong\u003e of this method is that:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eIt is the canonical way of doing this, which means it is the cleanest out of them all.\u003c/li\u003e\n\u003cli\u003eBecause the type of information is attached right alongside the code means you\u0026rsquo;ll have packaged this data out of the\nbox.\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe \u003cstrong\u003edownside\u003c/strong\u003e of it is that:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eIt isn\u0026rsquo;t backward compatible. You need Python \u003ccode\u003e3.6\u003c/code\u003e at least to use it.\u003c/li\u003e\n\u003cli\u003eIt also forces you to import \u003cstrong\u003eall\u003c/strong\u003e of your type dependencies, even though they are not used at runtime at all.\u003c/li\u003e\n\u003cli\u003eIn the type hints, you can have compound types, for example, \u003ccode\u003eList[int]\u003c/code\u003e. To construct these complex types, the\ninterpreter does need to do some operations when first loading this file.\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe last two points contradict the initial goal of the type system we enlisted before: handling all type information\nbasically as a comment during runtime. To resolve some of this contradiction \u003ccode\u003ePython 3.7\u003c/code\u003e introduces\n\u003ca href=\"https://peps.python.org/pep-0563/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-563 ~ postponed evaluation of annotations\u003c/a\u003e. Once you add the import of:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003e__future__\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eannotations\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe interpreter will no longer construct these compound types. Once the interpreter parses the scripts syntax tree, it\nidentifies type hints and bypasses evaluating it, keeping it as raw strings. This mechanism allows for type hint\ninterpretation to happen where they need to: by the linter when it runs type checks. Once the mythical \u003ccode\u003ePython 4\u003c/code\u003e comes\nto life, this mechanism shall be the default behavior.\u003c/p\u003e\n\u003ch3 id=\"2-type-comments\"\u003e\n  2. Type comments\n  \u003ca class=\"heading-link\" href=\"#2-type-comments\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eWhen the annotation syntax is not available, one can use the type comments:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"c1\"\u003e# type: () -\u0026gt; None\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: List[int]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"c1\"\u003e# type: (List[int]) -\u0026gt; None\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eGoing down this path, we do get some benefits:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eType comments work under any Python version. Although the typing library has been added to the standard library with\nPython \u003ccode\u003e3.5+\u003c/code\u003e is available as a PyPi package for Python \u003ccode\u003e2.7+\u003c/code\u003e. Moreover, because Python comments is a valid language\nfeature under virtually any Python code, this allows you to type-hint any codebase at or above Python \u003ccode\u003e2.7\u003c/code\u003e. There are\na few requirements: the type hint comment \u003cstrong\u003emust\u003c/strong\u003e be on the same or the next line where the function/variable\ndefinition is. It also starts with the \u003ccode\u003etype:\u003c/code\u003e constant.\u003c/li\u003e\n\u003cli\u003eThis solution also has packaging solved because comments are rarely stripped of your code once you stripped it.\nPackaging type hint information with your source code allows people using your library to use your type hint\ninformation to improve their developer experience.\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBut we also generate some new problems:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eThe downside is that although the type of information is close to the arguments, it\u0026rsquo;s not right beside it, making the\ncode a bit messier than otherwise would be. It must also be in a single line, causing issues if you have a long type\nof expression, and your codebase enforces line length limits.\u003c/li\u003e\n\u003cli\u003eAnother problem is that now the type hint information competes with other tools using these types of comment markers\n(e.g., suppressing other linter tools errors).\u003c/li\u003e\n\u003cli\u003eBesides forcing you to import all of your type information, this leaves you in an even more precarious place. Now the\nimported types are only used in the code, which leaves most linter tools to believe all those imports are unused. Were\nyou to allow them to remove it, and it does break your type linter. Note \u003ccode\u003epylint\u003c/code\u003e fixed this by moving its AST parser\nto a \u003ca href=\"https://github.com/PyCQA/pylint/issues/1063\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003etyped-ast parser\u003c/a\u003e, and is going to be released with version 2 just\nafter Python \u003ccode\u003e3.7\u003c/code\u003e comes out.\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTo avoid having long lines of code as type hint, it\u0026rsquo;s possible to type hint arguments one by one via type comments, and\nthen put in the line after only the return type annotation:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: List[int]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# type: (...) -\u0026gt; None\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eLet\u0026rsquo;s have a quick use look at how type comments can make your code messier. Below is a code snippet that swaps out two\nproperties values inside a class. Fairly trivial:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nd\"\u003e@contextmanager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eswap_in_state\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFirst, you must add type hints. Because the type hint would be long-winded, you attach type hint argument by argument:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nd\"\u003e@contextmanager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eswap_in_state\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: State\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: HasGetSetMutable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: Optional[HasGetSetMutable]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# type: (...) -\u0026gt; Generator[Tuple[HasGetSetMutable, Optional[HasGetSetMutable]], None, None]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHowever, wait, you need to import your types used:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTuple\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eOptional\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDict\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003emagic\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eRunSate\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eHasGetSetMutable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDict\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nd\"\u003e@contextmanager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eswap_in_state\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: State\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: HasGetSetMutable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: Optional[HasGetSetMutable]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# type: (...) -\u0026gt; Generator[Tuple[HasGetSetMutable, Optional[HasGetSetMutable]], None, None]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow formatting like this, the code causes some false positives in the static linter (e.g. \u003ccode\u003epylint\u003c/code\u003e here), so you add a\nfew suppress comments for this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eGenerator\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eTuple\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eOptional\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDict\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003emagic\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eRunSate\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eHasGetSetMutable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eDict\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# pylint: disable=invalid-name\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nd\"\u003e@contextmanager\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eswap_in_state\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: State\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: HasGetSetMutable\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: Optional[HasGetSetMutable]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# pylint: disable=bad-continuation\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# type: (...) -\u0026gt; Generator[Tuple[HasGetSetMutable, Optional[HasGetSetMutable]], None, None]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eyield\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoverrides\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eold_config\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eold_overrides\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNow you\u0026rsquo;re done. Nevertheless, you made your six lines of code sixteen lines long. Yay, more code to maintain!\nIncreasing your codebase only sounds good if you\u0026rsquo;re getting paid by the number line of code written, and your manager is\ncomplaining you\u0026rsquo;re not performing well enough.\u003c/p\u003e\n\u003ch3 id=\"3-interface-stub-files\"\u003e\n  3. Interface stub files\n  \u003ca class=\"heading-link\" href=\"#3-interface-stub-files\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eThis option allows you to keep your code as it is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eand instead, add another file with \u003ccode\u003epyi\u003c/code\u003e extension right beside it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# a.pyi alongside a.py\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eelements\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: List[int]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eelement\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eInterface files are not a new thing; C/C++ had it for decades now. Because Python is an interpreted language, it does\nnot need it usually, however as every problem in computer science can be solved by adding a new level of indirection, we\ncan add it to store the type of information.\u003c/p\u003e\n\u003cp\u003eThe upside of this is that:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eYou don\u0026rsquo;t need to modify the source code; works under any Python version as the interpreter never touches these.\u003c/li\u003e\n\u003cli\u003eInside the stub files, you can use the latest syntax (e.g., type annotations) because these are never looked at during\nyour application\u0026rsquo;s execution. Because you do not touch your source code, you cannot introduce bugs by adding type\nhints, nor can you add conflict with other linter tools.\u003c/li\u003e\n\u003cli\u003eIt is a well-tested design; the \u003ca href=\"https://github.com/python/typeshed\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003etypeshed\u003c/code\u003e\u003c/a\u003e project uses it to type hint the\nentire standard library, plus some other popular libraries such as \u003ccode\u003erequests\u003c/code\u003e, \u003ccode\u003eyaml\u003c/code\u003e, \u003ccode\u003edateutil\u003c/code\u003e and\n\u003ca href=\"https://github.com/python/typeshed/tree/master/stubs/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eso on\u003c/a\u003e. It can provide type information for source code that\nyou do not own or cannot change easily.\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNow there are also some hefty penalties to pay:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eYou just duplicated your codebase, as every function now has two definitions (note you don\u0026rsquo;t need to replicate your\nbody or default arguments, the \u003ccode\u003e...\u003c/code\u003e - ellipsis - is used as a placeholder for these).\u003c/li\u003e\n\u003cli\u003eNow, you have some extra files that need to be packaged and shipped with your code.\u003c/li\u003e\n\u003cli\u003eIt\u0026rsquo;s impossible to annotate contents inside functions (this means both methods inside methods and local variables).\u003c/li\u003e\n\u003cli\u003eThere is no check that your implementation file matches your stub\u0026rsquo;s signature (furthermore, IDEs always use the stub\ndefinition).\u003c/li\u003e\n\u003cli\u003eHowever, the heaviest penalty is that you cannot type check the code you\u0026rsquo;re type hinting via a stub. Stub file type\nhints were designed to be used to type-check code that uses the library. But not too type check the codebase itself\nwhat your type hinting.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cp\u003eThe last two drawback makes it incredibly hard to check that the type hinted codebase via a stub file is in sync or not.\nIn this current form, type stubs are a way to provide type hints to your users, but not for yourself, and are incredibly\nhard to maintain. To fix these, I\u0026rsquo;ve taken up the task of merging stub files with source files inside mypy; in theory,\nfix both problems - you can follow on its progress under\n\u003ca href=\"https://github.com/python/mypy/issues/5028\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epython/mypy ~ issue 5208\u003c/a\u003e.\u003c/p\u003e\n\u003ch3 id=\"4-docstrings\"\u003e\n  4. Docstrings\n  \u003ca class=\"heading-link\" href=\"#4-docstrings\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eIt is possible to add type information into docstrings too. Even though this is not part of Python\u0026rsquo;s type-hint\nframework, it is supported by most mainstream IDEs. They are mostly the legacy way of doing this.\u003c/p\u003e\n\u003cp\u003eOn the plus side:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eWorks under any Python version. It was defined back in \u003ca href=\"https://peps.python.org/pep-0257/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-257\u003c/a\u003e. It does not clash\nwith other linter tools, as most of these do not check the docstrings but usually resume just inspecting the other\ncode sections instead.\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHowever, it has serious flaws in the form of:\u003c/p\u003e\n\u003c!-- raw HTML omitted --\u003e\n\u003cul\u003e\n\u003cli\u003eThere is no standard way to specify complex type hints (for example, either \u003ccode\u003eint\u003c/code\u003e or \u003ccode\u003ebool\u003c/code\u003e). PyCharm has\n\u003ca href=\"https://www.jetbrains.com/help/pycharm/type-hinting-in-product.html#legacy\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eit\u0026rsquo;s the proprietary way\u003c/a\u003e but Sphinx, for\nexample, uses a different method. T- Docstring types do not clash with other linter tools.\u003c/li\u003e\n\u003cli\u003eRequires changing the documentation, and it is hard to keep accurate/up to date as there is no tool to check it\u0026rsquo;s\nvalidity.\u003c/li\u003e\n\u003cli\u003eDocstring types do not play well with type hinted code. If both type annotations and docstrings are specified, which\ntakes precedence over which?\n\u003c!-- raw HTML omitted --\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"what-to-add\"\u003e\n  What to add?\n  \u003ca class=\"heading-link\" href=\"#what-to-add\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/deep_dive_hu_160907ece21bcf56.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/deep_dive_hu_d391ef35a52d4dab.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/deep_dive.webp\" alt=\"Seal diving deep\"\n        width=\"700\" height=\"467\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eLet\u0026rsquo;s dive into the specifics, though. For an exhaustive list of what type of information you can add, please see the\n\u003ca href=\"https://docs.python.org/3/library/typing.html\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eofficial documentation\u003c/a\u003e. Here I\u0026rsquo;ll do a quick 3-minute overview for you\nto get the idea of it. There are two types of type categories: nominal types and duck types (protocols).\u003c/p\u003e\n\u003ch3 id=\"1-nominal-type\"\u003e\n  1. Nominal type\n  \u003ca class=\"heading-link\" href=\"#1-nominal-type\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eNominal types are types that have a name to it within the Python interpreter. For example all builtin types (\u003ccode\u003eint\u003c/code\u003e,\n\u003ccode\u003eboolean\u003c/code\u003e, \u003ccode\u003efloat\u003c/code\u003e, \u003ccode\u003etype\u003c/code\u003e, \u003ccode\u003eobject\u003c/code\u003e etc). Then we have the generic types which mostly manifest in form of the\ncontainers:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eTuple\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDict\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;b\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMutableMapping\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;b\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIterable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eText\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFor compound types, it can become cumbersome to keep writing it again and again, so the system allows you to alias\ntypes, via:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eOptFList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eOptional\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOne can even elevate builtin types to represent their own type, which can be useful to avoid errors where for example\nyou pass in two arguments with the same type in the wrong order to a function:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eUserId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNewType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;UserId\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003euser_id\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e524313\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecall_with_user_id_n_times\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euser_id\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFor \u003ccode\u003enamedtuple\u003c/code\u003e you can attach your type information directly (note the strong resemblance to a\n\u003ca href=\"https://peps.python.org/pep-0557/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003edata class\u003c/a\u003e from Python \u003ccode\u003e3.7+\u003c/code\u003e or the great\n\u003ca href=\"https://github.com/python-attrs/attrs\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003eattrs\u003c/code\u003e library\u003c/a\u003e):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eEmployee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eNamedTuple\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYou have the composing types of \u003cem\u003eone of\u003c/em\u003e and \u003cem\u003eoptional of\u003c/em\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# one of\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eOptional\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# either None or float\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYou can even type hint your callback functions:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# syntax is Callable[[Arg1Type, Arg2Type], ReturnType]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efeeder\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eget_next_item\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCallable\u003c/span\u003e\u003cspan class=\"p\"\u003e[[],\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOne can define it\u0026rsquo;s own generic containers by using the \u003ccode\u003eTypeVar\u003c/code\u003e construction:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s1\"\u003e\u0026#39;T\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eGeneric\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e]):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003esquare_values\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003evars\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIterable\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eMagic\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eFinally, disable type checking wherever it\u0026rsquo;s not needed by using the \u003ccode\u003eAny\u003c/code\u003e type hint:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efoo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"2-duck-types---protocols\"\u003e\n  2. Duck types - protocols\n  \u003ca class=\"heading-link\" href=\"#2-duck-types---protocols\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eIn this case, instead of having an actual type, one can be more Pythonic and go with the theorem that if it quacks like\na duck, and acts like a duck, then most definitely for all intended purposes, it is a duck. In this case, you define\nwhat operations and attributes you expect on objects instead of explicitly stating their types. The grounds of this were\nlaid down in \u003ca href=\"https://peps.python.org/pep-0544/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePEP-544 ~ Protocols\u003c/a\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eKEY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTypeVar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;KEY\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econtravariant\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# this is a protocol having a generic type as an argument\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# it has a class variable of type var, and a getter with the same key type\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMagicGetter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003eSized\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eKEY\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__getitem__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eKEY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc_int\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicGetter\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMagicGetter\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;a\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch1 id=\"gotchas\"\u003e\n  Gotchas\n  \u003ca class=\"heading-link\" href=\"#gotchas\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eOnce you start adding type hints to a codebase, watch out that sometimes you may experience some oddities. During these\nmoments, you might have the *what the hell** expression of the following seal:\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/gotcha_hu_7fc436a3b45f32f0.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/gotcha_hu_36e0e0742c89d325.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/gotcha.webp\" alt=\"Confused seal\"\n        width=\"700\" height=\"408\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eIn this section, I\u0026rsquo;ll try to present a few of these to give you a heads up on what kind of oddities you may run into\nwhile adding type information to your codebase.\u003c/p\u003e\n\u003ch3 id=\"1-str-difference-in-between-python-23\"\u003e\n  1. str difference in between Python 2/3\n  \u003ca class=\"heading-link\" href=\"#1-str-difference-in-between-python-23\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eHere\u0026rsquo;s a quick implementation of the \u003ccode\u003erepr\u003c/code\u003e dunder method for a class:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003e__future__\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eunicode_literals\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__repr__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;A(\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efull_name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis code has a bug in it. While this is correct under Python 3, it is not under Python 2 (because Python 2 expects to\nreturn \u003ccode\u003ebytes\u003c/code\u003e from \u003ccode\u003erepr\u003c/code\u003e. However, the \u003ccode\u003eunicode_literals\u003c/code\u003e import makes the returned value of type \u003ccode\u003eunicode\u003c/code\u003e). Having\nthe from future import in place means it\u0026rsquo;s not possible to write a \u003ccode\u003erepr\u003c/code\u003e that satisfies the type requirements for both\nPython 2 and 3. You need to add runtime logic to do the right thing:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003e__future__\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eunicode_literals\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__repr__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eres\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;A(\u003c/span\u003e\u003cspan class=\"si\"\u003e{}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efull_name\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003esys\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eversion_info\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"c1\"\u003e# noinspection PyTypeChecker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# noinspection PyTypeChecker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eres\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;utf-8\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eTo fight the IDE to accept this form, you need to add a few linter comments, making this code ever so complicated to\nread. More importantly, now you have an extra runtime check forced to your type checker.\u003c/p\u003e\n\u003ch3 id=\"2-multiple-return-types\"\u003e\n  2. Multiple return types\n  \u003ca class=\"heading-link\" href=\"#2-multiple-return-types\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eImagine you want to write a function that multiplies either a string or an int by two. The first take on this would be:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eYour input is either \u003ccode\u003estr\u003c/code\u003e or \u003ccode\u003eint\u003c/code\u003e, and your return value accordingly is also either \u003ccode\u003estr\u003c/code\u003e or \u003ccode\u003eint\u003c/code\u003e. However, if you do\nit like so, you\u0026rsquo;re telling the type hint that it really can be either of for both types of inputs. Therefore on the call\nside, you need to assert the type your calling with:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eother_func\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eassert\u003c/span\u003e \u003cspan class=\"nb\"\u003eisinstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis inconvenience may determine some people to avoid the call side hassle by making the return value \u003ccode\u003eAny\u003c/code\u003e. However,\nthere\u0026rsquo;s a better solution. The type hint system allows you to define overloads. Overloads express that for a given input\ntype, and only a given output type is returned. So, in this case:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eoverload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nd\"\u003e@overload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nd\"\u003e@overload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eother_func\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eresult\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThere is a downside to this, though. Now your static linter tool is complaining that you\u0026rsquo;re redefining functions with\nthe the same name; this is a false positive so add the static linter disable comment mark\n(\u003ccode\u003e# pylint: disable=function-redefined\u003c/code\u003e ).\u003c/p\u003e\n\u003ch3 id=\"3-type-lookup\"\u003e\n  3. Type lookup\n  \u003ca class=\"heading-link\" href=\"#3-type-lookup\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eImagine you have a class that allows representing the contained data as multiple types or that has fields of the\ndifferent type. You want the user to have a quick and easy way to refer to them, so you add a function, having a\nbuilt-in types name:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# type: () -\u0026gt; float\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOnce you run the linter, you\u0026rsquo;ll see:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest.py:3: error: Invalid \u003cspan class=\"nb\"\u003etype\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;test.A.float\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eOne might ask, at this point, what the hell? I\u0026rsquo;ve defined the return value as \u003ccode\u003efloat\u003c/code\u003e, not as \u003ccode\u003etest.A.float\u003c/code\u003e. This\nobscure error is that the type hinter resolves types by evaluating each scope outbound from the definition location.\nOnce it finds a name match, it stops. The first level where it looks is within \u003ccode\u003eclass A\u003c/code\u003e where it finds a \u003ccode\u003efloat\u003c/code\u003e (a\nfunction that is) and substitutes that float in.\u003c/p\u003e\n\u003cp\u003eNow the solution to not run into this issue is to explicitly define that we don\u0026rsquo;t just want any \u003ccode\u003efloat\u003c/code\u003e, but that we\nwant the \u003ccode\u003ebuiltin.float\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003etyping\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eTYPE_CHECKING\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ebuiltins\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# type: () -\u0026gt; builtins.float\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mf\"\u003e1.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eNote that to do this, you also need to import \u003ccode\u003ebuiltins\u003c/code\u003e, and to avoid this causing issues at runtime, you can guard it\nwith the \u003ccode\u003etyping.TYPE_CHECKING\u003c/code\u003e flag, which is true only during the type linter evaluation, always false otherwise.\u003c/p\u003e\n\u003ch3 id=\"4-contra-variant-argument\"\u003e\n  4. Contra-variant argument\n  \u003ca class=\"heading-link\" href=\"#4-contra-variant-argument\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eExamine the following use case. You define an abstract base class that contains everyday operations. Then you have\nspecific classes that handle one type and one type only. You control the creation of the classes, which ensures the\ncorrect type is passed, and the base is abstract, so this seems an agreeable design:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eabc\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eABCMeta\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eabstractmethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emetaclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eABCMeta\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nd\"\u003e@abstractmethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: (Union[int, str]) -\u0026gt; str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"ne\"\u003eNotImplementedError\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: (int) -\u0026gt; str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: (str) -\u0026gt; str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHowever, once you run a type linter check on this, you\u0026rsquo;ll find:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest.py:12: error: Argument \u003cspan class=\"m\"\u003e1\u003c/span\u003e of \u003cspan class=\"s2\"\u003e\u0026#34;func\u0026#34;\u003c/span\u003e incompatible with supertype \u003cspan class=\"s2\"\u003e\u0026#34;A\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest.py:17: error: Argument \u003cspan class=\"m\"\u003e1\u003c/span\u003e of \u003cspan class=\"s2\"\u003e\u0026#34;func\u0026#34;\u003c/span\u003e incompatible with supertype \u003cspan class=\"s2\"\u003e\u0026#34;A\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe reason for this is that arguments to classes are contra-variant. This translates in on scientific terms in your\nderived class you \u003cstrong\u003emust\u003c/strong\u003e handle all types from your parents. However, you may add additional types too. That is even\nin the function arguments; you can only extend what you cover, but not to constrain it in any way:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003eabc\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eABCMeta\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eabstractmethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eUnion\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emetaclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"n\"\u003eABCMeta\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nd\"\u003e@abstractmethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: (Union[int, str]) -\u0026gt; str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"ne\"\u003eNotImplementedError\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: (Union[int, str, bool]) -\u0026gt; str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: (Union[int, str, List]) -\u0026gt; str\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ekey\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"5-compatibility\"\u003e\n  5. Compatibility\n  \u003ca class=\"heading-link\" href=\"#5-compatibility\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h3\u003e\n\u003cp\u003eSee if you can spot the error in the following code snippet:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nd\"\u003e@classmethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;A\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nd\"\u003e@classmethod\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;B\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"bp\"\u003ecls\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eIf you did not manage yet, consider what will happen if you write the following script:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWere you to try to run it this would fail with the following runtime error:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ne\"\u003eTypeError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003emagic\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"n\"\u003emissing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003erequired\u003c/span\u003e \u003cspan class=\"n\"\u003epositional\u003c/span\u003e \u003cspan class=\"n\"\u003eargument\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;b\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThe reason being that \u003ccode\u003eB\u003c/code\u003e is a subtype of \u003ccode\u003eA\u003c/code\u003e. Therefore it can go into a container of \u003ccode\u003eA\u003c/code\u003e types (because it extends it\nto do more than \u003ccode\u003eA\u003c/code\u003e). However, the class method definition for \u003ccode\u003eB\u003c/code\u003e breaks this contract, it can no longer call magic\nwith just one argument. Moreover, the type linter would fail to point out only this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003etest.py:9: error: Signature of \u003cspan class=\"s2\"\u003e\u0026#34;magic\u0026#34;\u003c/span\u003e incompatible with supertype \u003cspan class=\"s2\"\u003e\u0026#34;A\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eA quick and easy fix for this is to make sure \u003ccode\u003eB.magic\u003c/code\u003e does work with one argument by making the second optional for\nexample. Now take what we learned to take a look at the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003epass\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nb\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWhat do you think will happen here? Note we moved class methods into constructors and made no other change, so our the\nscript also needs just a slight modification:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eType\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eType\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e]]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"ow\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003eelements\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eHere\u0026rsquo;s the runtime error, being mostly the same, just now complaining about \u003ccode\u003e__init__\u003c/code\u003e instead of \u003ccode\u003emagic\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eprint\u003cspan class=\"o\"\u003e(\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003ee\u003cspan class=\"o\"\u003e(\u003c/span\u003e1\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e e in elements\u003cspan class=\"o\"\u003e])\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eTypeError: __init__\u003cspan class=\"o\"\u003e()\u003c/span\u003e missing \u003cspan class=\"m\"\u003e1\u003c/span\u003e required positional argument: \u003cspan class=\"s1\"\u003e\u0026#39;b\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSo what do you think mypy will say? Were you to run it; you\u0026rsquo;ll find that mypy chooses to stay silent. Yes, it will mark\nthis as correct, even though at runtime, it fails. The mypy creators said that they found \u003cem\u003etoo common of type miss-match\nto prohibit incompatible \u003ccode\u003e__init__\u003c/code\u003e and \u003ccode\u003e__new__\u003c/code\u003e\u003c/em\u003e.\u003c/p\u003e\n\u003ch2 id=\"when-you-hit-the-wall\"\u003e\n  When you hit the wall\n  \u003ca class=\"heading-link\" href=\"#when-you-hit-the-wall\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eSo, in conclusion, watch out. Type hints sometimes cause strange warnings, which brings out the following feelings\nsummarized in a tweet:\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/david_hu_4837cda58bdec705.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/david_hu_ee85eb4f11166eb9.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/david.webp\" alt=\"Frustrated tweet about type hints\"\n        width=\"700\" height=\"448\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eRemember you have some tools at hand that help you discover, understand and perhaps handle these edge cases:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003euse \u003ccode\u003ereveal_type\u003c/code\u003e to see inferred type\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ereveal_type\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# -\u0026gt; error: Revealed type is \u0026#39;builtins.list[builtins.int*]\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003euse \u003ccode\u003ecast\u003c/code\u003e to force a given type:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003efrom\u003c/span\u003e \u003cspan class=\"nn\"\u003etyping\u003c/span\u003e \u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecast\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# passes fine\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: List[str] # passes fine (no runtime check)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ereveal_type\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# -\u0026gt; error: Revealed type is \u0026#39;builtins.list[builtins.str]\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003euse the type ignore marker to disable an error in a line:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econfusing_function\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# type: ignore # see mypy/issues/1167\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003eask the community; expose a minimal reproducible version of the problem under the\n\u003ca href=\"https://gitter.im/python/typing\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003epython/typing\u003c/a\u003e \u003ccode\u003eGitter\u003c/code\u003e chat.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"tools\"\u003e\n  Tools\n  \u003ca class=\"heading-link\" href=\"#tools\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eHere\u0026rsquo;s a non-exhaustive list of tools built around the type hint system.\u003c/p\u003e\n\u003ch2 id=\"type-checkers\"\u003e\n  type checkers\n  \u003ca class=\"heading-link\" href=\"#type-checkers\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eUse these tools to check against type safety inside your library or application:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"http://mypy-lang.org/\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003emypy\u003c/code\u003e - Python\u003c/a\u003e (the reference type linting tool)\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/facebook/pyre-check\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003epyre\u003c/code\u003e - Facebook\u003c/a\u003e - Python 3 only, but faster than mypy. An interesting use\ncase of this is the ability to do taint/security code analysis with it - see\n\u003ca href=\"https://www.youtube.com/watch?v=hWV8t494N88\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003ePieter Hooimeijer - Types, Deeper Static Analysis, and you\u003c/a\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/google/pytype\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003epytype\u003c/code\u003e - Google\u003c/a\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"type-annotation-generators\"\u003e\n  type annotation generators\n  \u003ca class=\"heading-link\" href=\"#type-annotation-generators\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eWhen you want to add type annotations to an existing codebase, use these to automate the boring part:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003emypy stubgen\u003c/code\u003e command line (\u003ca href=\"https://github.com/python/mypy/blob/master/mypy/stubgen.py\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003esee\u003c/a\u003e)\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/dropbox/pyannotate\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003epyannotate\u003c/code\u003e - Dropbox\u003c/a\u003e - use your tests to generate type information.\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Instagram/MonkeyType\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003emonkeytype\u003c/code\u003e - Instagram\u003c/a\u003e. Fun fact: Instagram uses to run it in their\nproduction system: it\u0026rsquo;s triggered once for every million cal (makes the code run five times slower, but once every\nmillion calls makes it not that noticeable).\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"runtime-code-evaluator\"\u003e\n  runtime code evaluator\n  \u003ca class=\"heading-link\" href=\"#runtime-code-evaluator\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eUse these tools to check at runtime if the input arguments to your function/method are of the correct type or not:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/samuelcolvin/pydantic\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003epydantic\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/RussBaz/enforce\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003eenforce\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Stewori/pytypes\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003epytypes\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"documentation-enrichment---merge-docstrings-and-type-hints\"\u003e\n  Documentation enrichment - merge docstrings and type hints\n  \u003ca class=\"heading-link\" href=\"#documentation-enrichment---merge-docstrings-and-type-hints\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h2\u003e\n\u003cp\u003eIn the first part of this blog article, we mentioned that historically people have already stored type information\ninside docstrings. This is because your type of data is part of your contract. You do want to have type information for\nyour library inside the documentation. So the question remains, given that you did not choose to use docstrings as the\nprimary type of information storage system, how can you still have them in the docstrings for your documentation?\u003c/p\u003e\n\u003cp\u003eThe answer varies depending on the tool you\u0026rsquo;re using to generate that documentation. However, I\u0026rsquo;m going to present here\nan option by using the most popular tool and format in Python: Sphinx and HTML.\u003c/p\u003e\n\u003cp\u003eHaving type information explicitly stated in both the type hints and the docstring is the sure way of eventually having\nconflicts between them. You can count on someone at some point is going to update in one place but not in the other.\nTherefore let\u0026rsquo;s strip all type data from the docstring and have it only as type hints. Now, all we need to do is at\ndocumentation build time, fetch it from the type hints and insert it into the documentation.\u003c/p\u003e\n\u003cp\u003eIn Sphinx, you can achieve this by having a plugin. The most popular already made version of this is\n\u003ca href=\"https://github.com/agronholm/sphinx-autodoc-typehints\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003e\u003ccode\u003eagronholm/sphinx-autodoc-typehints\u003c/code\u003e\u003c/a\u003e. This tool does two\nthings:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efirst, for each function/variable to be documented, it fetches the type hint information;\u003c/li\u003e\n\u003cli\u003ethen, it transforms the Python types into a docstring representation (this involves recursively unwrapping all the\nnested type classes, and replacing the type with its string representation);\u003c/li\u003e\n\u003cli\u003efinally, appending to the correct parameter into the docstring.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFor example \u003ccode\u003eAny\u003c/code\u003e maps to \u003ccode\u003epy:data:`~typing.Any`\u003c/code\u003e. Things can get even more complicated for compound types such as\n\u003ccode\u003eMapping[str, bool]\u003c/code\u003e needs to be translated for example too\n\u003ccode\u003e:class:`~typing.Mapping`\\\\[:class:`str`, :class:`bool`]\u003c/code\u003e. Getting the translation here right (e.g. having \u003ccode\u003eclass\u003c/code\u003e\nor \u003ccode\u003edata\u003c/code\u003e namespace) is essential so that the \u003ccode\u003eintersphinx\u003c/code\u003e plugin will work correctly (a plugin that links types\ndirectly to their respective Python standard library documentation link).\u003c/p\u003e\n\u003cp\u003eIn order to use it one needs to install it via \u003ccode\u003epip install sphinx-autodoc-types\u0026gt;=2.1.1\u003c/code\u003e and then enable in inside the\n\u003ccode\u003econf.py\u003c/code\u003e file:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# conf.py\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eextensions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;sphinx_autodoc_typehints\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThat\u0026rsquo;s it all. An example use case of this is \u003ca href=\"https://github.com/RookieGameDevs/revived\"  class=\"external-link\" target=\"_blank\" rel=\"noopener\"\u003eRookieGameDevs/revived\u003c/a\u003e\ndocumentation. For example, given the following source code:\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/sphinx_doc_src_hu_6e052643f6ba08bf.webp 500w, /posts/the-state-of-type-hints-in-python/sphinx_doc_src_hu_97bed83453356657.webp 800w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/sphinx_doc_src_hu_76bc09199564bbeb.webp 500w, /posts/the-state-of-type-hints-in-python/sphinx_doc_src_hu_9701ca0e9a360ff0.webp 800w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/sphinx_doc_src.webp\" alt=\"Sphinx documentation source code\"\n        width=\"800\" height=\"428\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003cp\u003eYou can get the following output:\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/sphinx_doc_hu_e39e006ff9931cc1.webp 500w, /posts/the-state-of-type-hints-in-python/sphinx_doc_hu_d0839e2b592606ac.webp 800w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/sphinx_doc_hu_9b06b72eb02fae21.webp 500w, /posts/the-state-of-type-hints-in-python/sphinx_doc_hu_98d291f2ffb9559e.webp 800w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/sphinx_doc.webp\" alt=\"Sphinx documentation output\"\n        width=\"800\" height=\"425\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n\u003ch1 id=\"conclusion\"\u003e\n  Conclusion\n  \u003ca class=\"heading-link\" href=\"#conclusion\"\u003e\n    \u003ci class=\"fa-solid fa-link\" aria-hidden=\"true\" title=\"Link to heading\"\u003e\u003c/i\u003e\n    \u003cspan class=\"sr-only\"\u003eLink to heading\u003c/span\u003e\n  \u003c/a\u003e\n\u003c/h1\u003e\n\u003cp\u003eSo at the end of this long blog post, you may ask: is it worth using type hints, or when should one use them? I think\ntype hinting is at the end of the day virtually the same as your unit tests, just expressed differently in code. They\nprovide a standard (and re-usable for other goals) way to test the input and output types of your codebase.\u003c/p\u003e\n\u003cp\u003eTherefore, type hints \u003cstrong\u003eshould be used whenever the unit test is worth writing.\u003c/strong\u003e This can be even just ten lines of\ncode if you need to maintain it later. Similarly, you should start adding type hints whenever you start writing unit\ntests. The only place when I would not add them is when I don\u0026rsquo;t write unit tests, such REPL lines, or throw away\none-time usage scripts.\u003c/p\u003e\n\u003cp\u003eRemember that, similar to unit tests, while it does makes your codebase contain an extra number of lines, at the end of\nthe day, all the code you add is code that is automatically checked and enforced to be correct. It acts as a safety net\nto ensure that things keep working when you change things around later on, so probably worth paying this extra cost.\u003c/p\u003e\n\u003cfigure\u003e\u003cpicture\u003e\n      \u003csource type=\"image/avif\" srcset=\"/posts/the-state-of-type-hints-in-python/thats_all_folks_hu_1424e91f8e4f99ab.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003csource type=\"image/webp\" srcset=\"/posts/the-state-of-type-hints-in-python/thats_all_folks_hu_2dff252a02830b01.webp 500w\" sizes=\"(min-width: 35em) 1200px, 100vw\"\u003e\n      \u003cimg src=\"/posts/the-state-of-type-hints-in-python/thats_all_folks.webp\" alt=\"Seal waving goodbye\"\n        width=\"700\" height=\"467\"\n        loading=\"lazy\" decoding=\"async\"\u003e\n    \u003c/picture\u003e\n\u003c/figure\u003e\n\n","date_published":"2018-05-30T09:51:55Z","date_modified":"2026-02-15T09:30:25-08:00","tags":["mypy","python","types","type-hint"]}]}