<!doctype html><html lang=en><head><title>Python packaging - Past, Present, Future · Bernát Gábor - Engineering & Open Source</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Bernát Gábor"><meta name=description content="A detailed look at how pip install works, from distutils to setuptools to PEP-517 and PEP-518"><meta name=keywords content="blog,developer,personal,python,packaging"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bernat.tech/posts/pep-517-518/header.webp"><meta name=twitter:title content="Python packaging - Past, Present, Future"><meta name=twitter:description content="A detailed look at how pip install works, from distutils to setuptools to PEP-517 and PEP-518"><meta property="og:url" content="https://bernat.tech/posts/pep-517-518/"><meta property="og:site_name" content="Bernát Gábor - Engineering & Open Source"><meta property="og:title" content="Python packaging - Past, Present, Future"><meta property="og:description" content="A detailed look at how pip install works, from distutils to setuptools to PEP-517 and PEP-518"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-07T13:40:59+00:00"><meta property="article:modified_time" content="2026-02-15T09:30:25-08:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Pip"><meta property="article:tag" content="Install"><meta property="article:tag" content="Packaging"><meta property="article:tag" content="Setuptools"><meta property="article:tag" content="Pep517"><meta property="og:image" content="https://bernat.tech/posts/pep-517-518/header.webp"><link rel=canonical href=https://bernat.tech/posts/pep-517-518/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.4b392a85107b91dbdabc528edf014a6ab1a30cd44cafcd5325c8efe796794fca.css integrity="sha256-SzkqhRB7kdvavFKO3wFKarGjDNRMr81TJcjv55Z5T8o=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.bf0650730c7d0092aa70ef86bf704ce59eba2988eb78b3fa8a6fee9376cd9d8f.css integrity="sha256-vwZQcwx9AJKqcO+Gv3BM5Z66KYjreLP6im/uk3bNnY8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/syntax.min.5ef6ece76ad413dd701da34ae4be6e9509707d3a12eb90066e18abb1c9f96dd3.css integrity="sha256-Xvbs52rUE91wHaNK5L5ulQlwfToS65AGbhirscn5bdM=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/img/android-chrome-192x192.png sizes=32x32><link rel=icon type=image/png href=/img/android-chrome-192x192.png sizes=16x16><link rel=apple-touch-icon href=/img/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=/img/android-chrome-192x192.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><link rel=preconnect href=https://github.com crossorigin><link rel=preconnect href=https://img.youtube.com crossorigin><link rel=preconnect href=https://static.cloudflareinsights.com crossorigin></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://bernat.tech/>Bernát Gábor - Engineering & Open Source
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts>Blog</a></li><li class=navigation-item><a class=navigation-link href=/presentations>Presentations</a></li><li class=navigation-item><a class=navigation-link href=/about>About</a></li><li class=navigation-item><a class=navigation-link href=/tags>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://bernat.tech/posts/pep-517-518/>Python packaging - Past, Present, Future</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-02-07T13:40:59Z>2019-02-02
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
9-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/python/>Python</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/pip/>Pip</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/install/>Install</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/packaging/>Packaging</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/setuptools/>Setuptools</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/pep517/>Pep517</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/pep518/>Pep518</a></span></div></div></header><div class=post-content><p>Have you ever wondered what happens exactly when you run pip install? This post will give you a detailed overview of the
steps involved in the past, and how it all changes with the adoption of PEP-517 and PEP-518.</p><p>[In my previous post](https://bernat.tech/posts/pep-517-and-python-packaging/) I&rsquo;ve described how it&rsquo;s possible to install three
types of content: source tree, source distribution, and wheels. Only the last two types are uploaded to PyPI, the
central Python repository. However, one could get its hands on a source tree (by feeding, for example, a git protocol
for pip). The advantage of wheels over the others is that it does not require any build operation to happen on the user
machine; it&rsquo;s just downloading and extract.</p><h2 id=building-python-packages>Building python packages
<a class=heading-link href=#building-python-packages><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Now independent of where the build happens (user or the developer machine), you still need to build the package (either
the sdist or wheel). To do this, you need some builders in place. Historically, the need for third-party packages
manifested itself early on. Following the principle that Python has batteries included in the year 2000 with Python 1.6,
the <a href=https://packaging.python.org/key_projects/#distutils class=external-link target=_blank rel=noopener>distutils</a> package was added to the Python standard library.
It introduced the concept of the <code>setup.py</code> file containing the build logic and is triggered via <code>python setup.py cmd</code>.</p><p>It allowed users to package code as libraries but did not have features such as declaration and automatic installation
of dependencies. Furthermore, its improvement lifecycle was directly tied to the core interpreter release cycle. In 2004
<code>setuptools</code> was created, built on top of <code>distutils</code>, and extended with other excellent features. It quickly became so
prevalent that most python installations started to provide it together with the core interpreter itself.</p><p>Back in those days, all packages were source distributions. Wheel distributions came along a lot later, in 2014.
<em>distutils</em> was created back when only a few highly proficient people did the packaging. It is very flexible and
imperative; you write a python script to modify every step in the package generation process.</p><p>The downside of this, though, is that it&rsquo;s anything but easy to learn and understand. This started to become more and
more an issue as Python grew in popularity and we had more and more users who were less proficient in the inner workings
of Python.</p><figure><img src=/posts/pep-517-518/smart_pug.webp alt="Smart pug" width=400 height=600 loading=lazy decoding=async></figure><h3 id=build-requirements>build requirements
<a class=heading-link href=#build-requirements><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>For installing a source distribution pip mostly <strong>did</strong> the following:</p><ol><li>discover the package</li><li>download the source distribution and extract it</li><li>run <code>python setup.py install</code> on the extracted folder (does a build + install).</li></ol><p>Developers did <code>python setup.py sdist</code> to generate the distribution and <code>python setup.py upload</code> to upload it to a
central repository (the upload command has been deprecated with 2013 in favor of the
<a href=https://pypi.org/project/twine/ class=external-link target=_blank rel=noopener>twine</a> tool most notably due to the upload using a non-secure HTTP connection, and
upload command also did a fresh build, not allowing the end-user to inspect the generated package before the actual
upload).</p><p>When pip ran the <code>python setup.py install</code>, it did so with the python interpreter for which it was installing the
package. As such the build operation had access to all third-party packages already available inside that interpreter.
Most notably, it used exactly the <em>setuptools</em> version that was installed on the host python interpreter. If a package
used a <em>setuptools</em> feature available on a newer release than currently installed, the only way one could complete the
installation was to update first the installed <em>setuptools.</em></p><p>This potentially can cause problems if a new release contained a bug that broke other packages. It is especially
troublesome on systems where the users can&rsquo;t alter installed packages. Then there was also the problem of what happens
when the builder (e.g., setuptools) wants to use other helper packages, such as cython.</p><p>If any of these helpers were missing the build usually just broke with a failed to import package error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl>      <span class=n>File</span> <span class=s2>&#34;setup_build.py&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>99</span><span class=p>,</span> <span class=ow>in</span> <span class=n>run</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>Cython.Build</span> <span class=kn>import</span> <span class=n>cythonize</span>
</span></span><span class=line><span class=cl>    <span class=ne>ImportError</span><span class=p>:</span> <span class=n>No</span> <span class=n>module</span> <span class=n>named</span> <span class=n>Cython</span><span class=o>.</span><span class=n>Build</span>
</span></span></code></pre></div><p>There was no way to provide such build dependencies from the developers&rsquo; side. It also meant that users needed to
install all packaging build dependencies even if they did not want to use that at runtime. To solve this issue
<a href=https://peps.python.org/pep-0518/ class=external-link target=_blank rel=noopener>PEP-518</a> was created.</p><p>The idea is that instead of using the host python with its currently installed packages for the build, the package
provides the ability to be explicit about what they need for their build operation. Instead of making this available on
the host python, we create an isolated python (think of a virtual environment) to run the packaging command.</p><p><code>python setup.py install</code> now becomes:</p><ol><li>create a temporary folder</li><li>create an isolated (from the third-party <code>site-packages</code>) python environment <code>python -m virtualenv our_build_env</code>,
let&rsquo;s refer to this python executable as <code>python_isolated</code></li><li>install the build dependencies</li><li>generate a wheel we can install via <code>python_isolated setup.py bdist_wheel</code></li><li>extract wheel to site packages of <code>python</code>.</li></ol><p>With this we can install packages that depend on <code>cython</code> without actually installing <code>cython</code> inside the runtime python
environment. The file and method of specifying the build dependencies is the <code>pyproject.toml</code> metadata file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>build-system</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>requires</span> <span class=p>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;setuptools&gt;=44&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;wheel&gt;=0.30.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;cython&gt;=0.29.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span></code></pre></div><p>Furthermore, this also allows for whoever does the packaging to be explicit about what minimum versions they require for
the packaging and these can be quickly provisioned via pip transparently on the user machines.</p><p>The same mechanism can also be used when generating the source distribution or the wheel on the developers&rsquo; machine.
When one invokes the <code>pip wheel . --no-deps</code> command that will automatically create in the background an isolated python
that satisfies the build systems dependencies, and then call inside that environment the <code>python setup.py bdist_wheel</code>
or <code>python setup.py sdist</code> command.</p><figure><img src=/posts/pep-517-518/jump_pug.webp alt="Jumping pug" width=400 height=600 loading=lazy decoding=async></figure><h3 id=packaging-tool-diversity>packaging tool diversity
<a class=heading-link href=#packaging-tool-diversity><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Now there&rsquo;s one more problem here, though. Note all these operations still go through the mechanism introduced twenty
years ago, aka executing <code>setup.py</code>. The whole ecosystem still builds on the top of the <em>distutils</em> and <em>setuptools</em>
interface that cannot change much due to trying to preserving backward compatibility.</p><p>Also, executing arbitrary user-side Python code during packaging though is dangerous, leading to subtle errors hard to
debug by less experienced users. Imperative build systems were great for flexibility twenty years ago when we were not
aware of all the use cases. Still, now that we have a good understanding, we can probably make very robust and easy
package builders for various use cases.</p><p>To quote <a href=https://twitter.com/pganssle class=external-link target=_blank rel=noopener>Paul Ganssle</a> (maintainer of <code>setuptools</code>and <code>dateutil</code> on this):</p><blockquote><p>Ideally, the default option would be a declarative build configuration that works well for the 99% case, with an
option to fall back to an imperative system when you need the flexibility. At this point, it&rsquo;s feasible for us to move
to a world where it&rsquo;s considered a code smell if you find you need to reach for the imperative build options.</p></blockquote><blockquote><p>The biggest problem with <code>setup.py</code> is that most people use it declaratively, and when they use it imperatively, they
tend to introduce bugs into the build system. One example of this: if you have a Python 2.7-only dependency, you may
be tempted to specify it conditionally with <code>sys.version</code> in your <code>setup.py</code>, but <code>sys.version</code> only refers to the
interpreter that <em>executed</em> the build; instead, you should be using the declarative environment markers for your
install requirements.</p></blockquote><p><a href=https://pypi.org/project/flit/ class=external-link target=_blank rel=noopener>flit</a> proved this assumption correct already with its introduction in 2015. It has
become the favorite packaging tool for many newcomers to Python, making sure new users avoid many foot guns. However, to
get to this point, <code>flit</code> had to again build on top of <em>distutils</em>/<em>setuptools,</em> which makes its implementation
non-trivial, and the codebase quite a few shim layers (it still generates the <code>setup.py</code> file, for example, for its
source distributions).</p><p>It&rsquo;s time to free it from these shackles and encourage other people to build their packaging tools that make packaging
easy for their use cases, making <code>setup.py</code> the exception rather than the default.
<a href=https://github.com/pypa/setuptools/pull/1675 class=external-link target=_blank rel=noopener><code>setuptools</code> plans to offer a <code>setup.cfg</code></a> the only user interface to
lead the way, and when a PEP-517 system is in place, you should prefer that overusing the <code>setup.py</code> for most cases. To
not tie everything back to <code>setuptools</code> and <code>distutils</code> and facilitate the creation of new-build backends
<a href=https://peps.python.org/pep-0517/ class=external-link target=_blank rel=noopener>PEP-517</a> was created. It separates builders into a backend and frontend. The
frontend provides an isolated python environment satisfying all the declared build dependencies; the backend provides
hooks that the frontend can call from its isolated environment to generate either a source distribution or wheel.</p><p>Furthermore, instead of talking with the backend via the <code>setup.py</code> file and its commands, we move to python modules and
functions. All packaging backends must provide a python object API that implements two methods
<a href=https://peps.python.org/pep-0517/#build-wheel class=external-link target=_blank rel=noopener>build_wheel</a> and <a href=https://peps.python.org/pep-0517/#id9 class=external-link target=_blank rel=noopener>build_sdist</a> at
the minimum. The API object point is specified via the <code>pyproject.toml</code> file under the <code>build-backend</code> key:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>build-system</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>requires</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;flit&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>build-backend</span> <span class=p>=</span> <span class=s2>&#34;flit.api:main&#34;</span>
</span></span></code></pre></div><p>The above code effectively means for the frontend that you can get hold of the backend by running the above code inside
the isolated python environment:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>flit.api</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>backend</span> <span class=o>=</span> <span class=n>flit</span><span class=o>.</span><span class=n>api</span><span class=o>.</span><span class=n>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># build wheel via</span>
</span></span><span class=line><span class=cl><span class=n>backend</span><span class=o>.</span><span class=n>build_wheel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># build source distribution via</span>
</span></span><span class=line><span class=cl><span class=n>backend</span><span class=o>.</span><span class=n>build_sdist</span><span class=p>()</span>
</span></span></code></pre></div><p>It&rsquo;s up to the backend where and how they want to expose their official API:</p><ol><li><a href=https://flit.readthedocs.io/en/latest/ class=external-link target=_blank rel=noopener>flit</a> does it via <code>flit.buildapi</code></li><li><a href=https://setuptools.readthedocs.io/en/latest/history.html#v40-8-0 class=external-link target=_blank rel=noopener>setuptools</a> provides two variants:
<code>setuptools.build_meta</code> (on why read on later)</li><li><a href=https://poetry.eustace.io/docs/pyproject/#poetry-and-pep-517 class=external-link target=_blank rel=noopener>poetry</a> does it via <code>poetry.masonry.api</code></li></ol><p>With this, we can start having packaging tools that are no longer bound to the legacy decisions of the <code>distutils</code> in
the frontend.</p><figure><img src=/posts/pep-517-518/curious_pug.webp alt="Curious pug" width=400 height=600 loading=lazy decoding=async></figure><h1 id=tox-and-packaging>tox and packaging
<a class=heading-link href=#tox-and-packaging><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p><a href=https://tox.readthedocs.io/en/latest/ class=external-link target=_blank rel=noopener>tox is testing tool</a> and used by most projects to ensure compatibility against
multiple Python interpreter versions of a given package. It also allows the quick creation of Python environments with
the package under inspection installed in it, making reproducing failures faster.</p><p>To be able to test a package, it first needs to build a source distribution, though. While both PEP-518 and PEP-517
should make things better, turning them on can break packaging under some use cases. Therefore when
<a href=https://tox.readthedocs.io/en/latest/ class=external-link target=_blank rel=noopener><code>tox</code></a> added isolated build in version
<a href=https://tox.readthedocs.io/en/latest/ class=external-link target=_blank rel=noopener><code>3.3.0</code></a> decided not to enable it by default, for now. You need to enable it
manually (it will be turned on by default in version <code>4</code> sometime later this year - 2021).</p><p>Once you&rsquo;ve specified a <code>pyproject.toml</code> with appropriate <code>requires</code> and <code>build-backend</code>, you need to turn on the
<code>isolated_build</code> flag inside <code>tox.ini</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[tox]</span>
</span></span><span class=line><span class=cl><span class=na>isolated_build</span> <span class=o>=</span> <span class=s>True</span>
</span></span></code></pre></div><p>After this, tox in the <a href=https://tox.readthedocs.io/en/latest/#system-overview class=external-link target=_blank rel=noopener>packaging phase</a> will build the source
distribution (by providing the build dependencies into an isolated python environment as per PEP-518). Afterward will
call the build backend as stated in PEP-517. Otherwise, tox will use the old way of building source distributions,
invoking the <code>python setup.py sdist</code> command with the same interpreter tox is installed into.</p><figure><img src=/posts/pep-517-518/moody_pug.webp alt="Moody pug" srcset="/posts/pep-517-518/moody_pug_hu_94a4de09c68b721d.webp 500w" sizes="(min-width: 35em) 1200px, 100vw" width=700 height=467 loading=lazy decoding=async></figure><h2 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The Python Packaging Authority hopes that all this makes sense and will have more user-friendly, error-proof and stable
builds. The specifications for these standards were written up and debated in long threads between 2015 and 2017. The
proposals were deemed good enough to benefit the most, but some less mainstream use cases could have been overlooked.</p><p>If your use case is such, don&rsquo;t worry the PEPs are open to enhancement at any point if we deem required. [In my next
post of this series here](https://bernat.tech/posts/growing-pain/) I&rsquo;ll go over some of the pain points the community bumped into
while releasing these two PEPs. These should serve as lessons learned and show that there&rsquo;s still some work to be done.
It&rsquo;s not everything perfect yet. However, we&rsquo;re getting better. Join the packaging community if you can help out, and
let&rsquo;s make things better together!</p></div><footer><div class=related-posts><h3>Related Posts</h3><ul><li><a href=https://bernat.tech/posts/growing-pain/>Python packaging - Growing Pains</a>
<span class=date>- 2019-02-02</span></li><li><a href=https://bernat.tech/posts/pep-517-and-python-packaging/>The state of Python Packaging</a>
<span class=date>- 2019-02-02</span></li><li><a href=https://bernat.tech/posts/version-numbers/>Version numbers: how to use them?</a>
<span class=date>- 2020-05-05</span></li><li><a href=https://bernat.tech/posts/the-state-of-type-hints-in-python/>The state of type hints in Python</a>
<span class=date>- 2018-05-05</span></li></ul></div></footer></article></section></div><footer class=footer><section class=container><b>Opinions are my own</b>.
Updated&nbsp;<time id=footer-ts datetime=2026-02-15T17:30:25.000Z>2026-02-15T17:30:25.000Z&nbsp;UTC</time>
via <a href=https://github.com/gaborbernat/bernat-tech/commit/2aff29d63d4dcb532fcf5da08836e78f9bda85fe>2aff29d</a>
.
© 2018-2026
<script defer src=/js/footer.min.8e5ddf117b308fa71b1dcc4999cbe7be4452e2ed7aaf440c730dea0d6cdf4d19.js integrity="sha256-jl3fEXswj6cbHcxJmcvnvkRS4u16r0QMcw3qDWzfTRk="></script></section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "3ead932f454449a799915b1721c18874"}'></script></body></html>